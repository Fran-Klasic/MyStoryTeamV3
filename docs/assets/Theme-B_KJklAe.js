function m(s){return Number(s)!==s}function O(s){return{}.toString.call(s)}function z(s,e="Assertion failed"){if(!s)throw new Error(e)}function A(s){if(s!=null&&!d(s)){let e=Number(s);if(m(e)&&C(s)&&s!=""&&s.match(/[0-9]+/)){const t=s.replace(/[^0-9.\-]+/g,"");return s===t?e:A(t)}return e}return s}function F(s){if(k(s))return new Date(s);if(d(s))return new Date(s);{let e=Number(s);return d(e)?new Date(e):new Date(s)}}function $(s){if(m(s))return"NaN";if(s===1/0)return"Infinity";if(s===-1/0)return"-Infinity";if(s===0&&1/s===-1/0)return"-0";let e=s<0;s=Math.abs(s);let t=/^([0-9]+)(?:\.([0-9]+))?(?:e[\+\-]([0-9]+))?$/.exec(""+s),i=t[1],n=t[2]||"",r;if(t[3]===void 0)r=n===""?i:i+"."+n;else{let o=+t[3];if(s<1){let h=o-1;r="0."+g("0",h)+i+n}else{let h=o-n.length;h===0?r=i+n:h<0?r=i+n.slice(0,h)+"."+n.slice(h):r=i+n+g("0",h)}}return e?"-"+r:r}function g(s,e){return new Array(e+1).join(s)}function k(s){return O(s)==="[object Date]"}function C(s){return typeof s=="string"}function d(s){return typeof s=="number"&&Number(s)==s}function L(s){return typeof s=="object"&&s!==null}function B(s){return Array.isArray(s)}const V="__§§§__",H="__§§§§__",Ee=Object.freeze(Object.defineProperty({__proto__:null,PLACEHOLDER:V,PLACEHOLDER2:H,assert:z,getType:O,isArray:B,isDate:k,isNaN:m,isNumber:d,isObject:L,isString:C,numberToString:$,repeat:g,toDate:F,toNumber:A},Symbol.toStringTag,{value:"Module"}));function b(s,e){const t=s.length;for(let i=0;i<t;++i)if(s[i]===e)return i;return-1}function P(s,e){const t=s.length;for(let i=0;i<t;++i)if(e(s[i]))return!0;return!1}function K(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=e(s[n],n);return i}function l(s,e){const t=s.length;for(let i=0;i<t;++i)e(s[i],i)}function Y(s,e){let t=s.length;for(;t>0;)--t,e(s[t],t)}function q(s,e){const t=s.length;for(let i=0;i<t&&e(s[i],i);++i);}function G(s,e){const t=s.length;for(let i=e;i<t;++i)s[i-e]=s[i];s.length=t-e}function J(s){const e=s.length;return e?s[e-1]:void 0}function Q(s){return s[0]}function x(s,e,t){t=Math.max(0,Math.min(t,s.length)),s.splice(t,0,e)}function U(s,e,t){D(s,e),x(s,e,t)}function W(s,e){const t=e.length;for(let i=0;i<t;++i)s.push(e[i])}function D(s,e){let t=!1,i=0;for(;;){if(i=s.indexOf(e,i),i===-1)return t;t=!0,s.splice(i,1)}}function _(s,e){let t=s.indexOf(e);return t!==-1?(s.splice(t,1),!0):!1}function X(s,e,t){let i=b(s,e);i!==-1&&I(s,i),t==null?s.push(e):y(s,t,e)}function Z(s,e,t){d(t)?t===0?s.unshift(e):s.splice(t,0,e):s.push(e)}function ee(s,e){s.indexOf(e)===-1&&s.push(e)}function te(s,e,t){let i=s.indexOf(e);i!==-1&&s.splice(i,1),d(t)?s.splice(t,0,e):s.push(e)}function se(s){return Array.isArray(s)?s:[s]}function ie(s,e){return b(s,e)!==-1}function ne(s){const e=s.length,t=new Array(e);for(let i=0;i<e;++i)t[i]=s[i];return t}function re(s,e,t=s.length){const i=new Array(t-e);for(let n=e;n<t;++n)i[n-e]=s[n];return i}function y(s,e,t){s.splice(e,0,t)}function I(s,e){s.splice(e,1)}function v(s,e){const t=s.length;for(let i=0;i<t;++i)if(e(s[i],i))return i;return-1}function R(s,e){let t=s.length;for(;t>0;)if(--t,e(s[t],t))return t;return-1}function oe(s,e){const t=v(s,e);if(t!==-1)return s[t]}function he(s,e){const t=R(s,e);if(t!==-1)return s[t]}function le(s,e){const t=s.length;for(let i=0;i<t;++i){const n=e(s[i],i);if(n!==void 0)return n}}function ue(s){let e=s.length,t,i;for(;e!==0;)i=Math.floor(Math.random()*e),e-=1,t=s[e],s[e]=s[i],s[i]=t}function j(s,e){let t=0,i=s.length,n=!1;for(;t<i;){const r=t+i>>1,o=e(s[r]);o<0?t=r+1:o===0?(n=!0,t=r+1):i=r}return{found:n,index:n?t-1:t}}function de(s,e){let t=0,i=s.length,n=!1;for(;t<i;){const r=t+i>>1,o=e(s[r]);o<0?t=r+1:(o===0&&(n=!0),i=r)}return{found:n,index:t}}function ce(s,e){let t=s.length;for(;t>0;)--t,e(s[t])||s.splice(t,1)}const Te=Object.freeze(Object.defineProperty({__proto__:null,add:Z,any:P,copy:ne,each:l,eachContinue:q,eachReverse:Y,find:oe,findIndex:v,findIndexReverse:R,findMap:le,findReverse:he,first:Q,getFirstSortedIndex:de,getSortedIndex:j,has:ie,indexOf:b,insert:x,insertIndex:y,keepIf:ce,last:J,map:K,move:X,pushAll:W,pushOne:ee,remove:D,removeFirst:_,removeIndex:I,replace:te,setIndex:U,shiftLeft:G,shuffle:ue,slice:re,toArray:se},Symbol.toStringTag,{value:"Module"}));function a(s){return Object.keys(s)}function pe(s){return Object.entries(s)}function M(s,e){return a(s).sort(e)}function fe(s){return Object.assign({},s)}function u(s,e){a(s).forEach(t=>{e(t,s[t])})}function _e(s,e){for(let t in s)if(N(s,t)&&!e(t,s[t]))break}function ae(s,e,t){l(M(s,t),i=>{e(i,s[i])})}function N(s,e){return{}.hasOwnProperty.call(s,e)}function ge(s,e){return u(s,(t,i)=>{i!=null&&e[t]==null&&(e[t]=i)}),e}const Se=Object.freeze(Object.defineProperty({__proto__:null,copy:fe,each:u,eachContinue:_e,eachOrdered:ae,entries:pe,hasKey:N,keys:a,keysOrdered:M,softCopyProperties:ge},Symbol.toStringTag,{value:"Module"}));class E{constructor(){this._disposed=!1}isDisposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._dispose())}}class p{constructor(e){this._disposed=!1,this._dispose=e}isDisposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._dispose())}}class Oe extends E{constructor(){super(...arguments),this._disposers=[]}_dispose(){l(this._disposers,e=>{e.dispose()})}}class T extends E{constructor(e){super(),this._disposers=e}_dispose(){l(this._disposers,e=>{e.dispose()})}get disposers(){return this._disposers}}class Ae extends E{_dispose(){this._disposer!=null&&(this._disposer.dispose(),this._disposer=void 0)}get(){return this._value}set(e,t){this._disposer!=null&&this._disposer.dispose(),this._disposer=t,this._value=e}reset(){this.set(void 0,void 0)}}class ke extends p{constructor(){super(...arguments),this._counter=0}increment(){return++this._counter,new p(()=>{--this._counter,this._counter===0&&this.dispose()})}}class we{constructor(){this._listeners=[],this._killed=[],this._disabled={},this._iterating=0,this._enabled=!0,this._disposed=!1}isDisposed(){return this._disposed}dispose(){if(!this._disposed){this._disposed=!0;const e=this._listeners;this._iterating=1,this._listeners=null,this._disabled=null;try{l(e,t=>{t.disposer.dispose()})}finally{this._killed=null,this._iterating=null}}}hasListeners(){return this._listeners.length!==0}hasListenersByType(e){return P(this._listeners,t=>(t.type===null||t.type===e)&&!t.killed)}enable(){this._enabled=!0}disable(){this._enabled=!1}enableType(e){delete this._disabled[e]}disableType(e,t=1/0){this._disabled[e]=t}_removeListener(e){if(this._iterating===0){const t=this._listeners.indexOf(e);if(t===-1)throw new Error("Invalid state: could not remove listener");this._listeners.splice(t,1)}else this._killed.push(e)}_removeExistingListener(e,t,i,n){if(this._disposed)throw new Error("EventDispatcher is disposed");this._eachListener(r=>{r.once===e&&r.type===t&&(i===void 0||r.callback===i)&&r.context===n&&r.disposer.dispose()})}isEnabled(e){if(this._disposed)throw new Error("EventDispatcher is disposed");return this._enabled&&this._listeners.length>0&&this.hasListenersByType(e)&&this._disabled[e]===void 0}removeType(e){if(this._disposed)throw new Error("EventDispatcher is disposed");this._eachListener(t=>{t.type===e&&t.disposer.dispose()})}has(e,t,i){return v(this._listeners,r=>r.once!==!0&&r.type===e&&(t===void 0||r.callback===t)&&r.context===i)!==-1}_shouldDispatch(e){if(this._disposed)throw new Error("EventDispatcher is disposed");const t=this._disabled[e];return d(t)?(t<=1?delete this._disabled[e]:--this._disabled[e],!1):this._enabled}_eachListener(e){++this._iterating;try{l(this._listeners,e)}finally{--this._iterating,this._iterating===0&&this._killed.length!==0&&(l(this._killed,t=>{this._removeListener(t)}),this._killed.length=0)}}dispatch(e,t){this._shouldDispatch(e)&&this._eachListener(i=>{!i.killed&&(i.type===null||i.type===e)&&(i._debounceDelay?(i._debounceTimeout&&window.clearTimeout(i._debounceTimeout),i._debounceTimeout=window.setTimeout(()=>{i._debounceTimeout=void 0,i.killed||i.dispatch(e,t)},i._debounceDelay)):i.dispatch(e,t))})}_on(e,t,i,n,r,o,h){if(this._disposed)throw new Error("EventDispatcher is disposed");this._removeExistingListener(e,t,i,n);const c={type:t,callback:i,context:n,shouldClone:r,dispatch:o,killed:!1,once:e,disposer:new p(()=>{c.killed=!0,c._debounceTimeout&&window.clearTimeout(c._debounceTimeout),this._removeListener(c)}),_debounceDelay:h};return this._listeners.push(c),c}onAll(e,t,i=!0){return this._on(!1,null,e,t,i,(n,r)=>e.call(t,r)).disposer}on(e,t,i,n=!0){return this._on(!1,e,t,i,n,(r,o)=>t.call(i,o)).disposer}onDebounced(e,t,i,n,r=!0){return this._on(!1,e,t,n,r,(o,h)=>t.call(n,h),i).disposer}once(e,t,i,n=!0){const r=this._on(!0,e,t,i,n,(o,h)=>{r.disposer.dispose(),t.call(i,h)});return r.disposer}off(e,t,i){this._removeExistingListener(!1,e,t,i)}copyFrom(e){if(this._disposed)throw new Error("EventDispatcher is disposed");if(e===this)throw new Error("Cannot copyFrom the same TargetedEventDispatcher");const t=[];return l(e._listeners,i=>{!i.killed&&i.shouldClone&&(i.type===null?t.push(this.onAll(i.callback,i.context)):i.once?t.push(this.once(i.type,i.callback,i.context)):t.push(this.on(i.type,i.callback,i.context)))}),new T(t)}}function f(s,e){return s===e?0:s<e?-1:1}function me(s,e,t){const i=s.length,n=e.length,r=Math.min(i,n);for(let o=0;o<r;++o){const h=t(s[o],e[o]);if(h!==0)return h}return f(i,n)}function Ce(s,e){return s===e?0:s<e?-1:1}function w(s){u(s,(e,t)=>{L(t)&&typeof t.dispose=="function"&&(t.enableDispose=!0,t.dispose())})}class be{constructor(e,t,i){this._name=e,this._template=t,this._settings=i}_dispose(){w(this._settings)}get(e,t){const i=this._settings[e];return i!==void 0?i:t}set(e,t){this._settings[e]=t,this._template._stateChanged(this._name)}remove(e){delete this._settings[e],this._template._stateChanged(this._name)}setAll(e){a(e).forEach(t=>{this._settings[t]=e[t]}),this._template._stateChanged(this._name)}_apply(e,t){u(this._settings,(i,n)=>{!t[i]&&!e._userSettings[i]&&(t[i]=!0,e.setRaw(i,n))})}}class De{constructor(e){this._states={},this._template=e}_dispose(){u(this._states,(e,t)=>{t._dispose()})}lookup(e){return this._states[e]}create(e,t){const i=this._states[e];if(i)return i.setAll(t),i;{const n=new be(e,this._template,t);return this._states[e]=n,this._template._stateChanged(e),n}}remove(e){delete this._states[e],this._template._stateChanged(e)}_apply(e,t){u(this._states,(i,n)=>{let r=t.states[i];r==null&&(r=t.states[i]={});const o=e.states.create(i,{});n._apply(o,r)})}}class ve{constructor(){this._callbacks={}}add(e,t){let i=this._callbacks[e];return i===void 0&&(i=this._callbacks[e]=[]),i.push(t),new p(()=>{_(i,t),i.length===0&&delete this._callbacks[e]})}remove(e){this._callbacks[e]!==void 0&&delete this._callbacks[e]}_apply(e){const t=[];return u(this._callbacks,(i,n)=>{l(n,r=>{t.push(e.adapters.add(i,r))})}),new T(t)}}class S{constructor(e,t){if(this._disposed=!1,this._privateSettings={},this._settingEvents={},this._privateSettingEvents={},this._entities=[],this.states=new De(this),this.adapters=new ve,this.events=new we,!t)throw new Error("You cannot use `new Class()`, instead use `Class.new()`");this._settings=e}static new(e){return new S(e,!0)}_dispose(){w(this._settings),w(this._privateSettings)}isDisposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._dispose())}_checkDisposed(){if(this._disposed)throw new Error("Template is disposed")}get entities(){return this._entities}get(e,t){this._checkDisposed();const i=this._settings[e];return i!==void 0?i:t}setRaw(e,t){this._checkDisposed(),this._settings[e]=t}set(e,t){this._checkDisposed(),this._settings[e]!==t&&(this.setRaw(e,t),this._entities.forEach(i=>{i._setTemplateProperty(this,e,t)}))}remove(e){this._checkDisposed(),e in this._settings&&(delete this._settings[e],this._entities.forEach(t=>{t._removeTemplateProperty(e)}))}removeAll(){this._checkDisposed(),u(this._settings,(e,t)=>{this.remove(e)})}getPrivate(e,t){this._checkDisposed();const i=this._privateSettings[e];return i!==void 0?i:t}setPrivateRaw(e,t){return this._checkDisposed(),this._privateSettings[e]=t,t}setPrivate(e,t){return this._checkDisposed(),this._privateSettings[e]!==t&&(this.setPrivateRaw(e,t),this._entities.forEach(i=>{i._setTemplatePrivateProperty(this,e,t)})),t}removePrivate(e){this._checkDisposed(),e in this._privateSettings&&(delete this._privateSettings[e],this._entities.forEach(t=>{t._removeTemplatePrivateProperty(e)}))}setAll(e){this._checkDisposed(),u(e,(t,i)=>{this.set(t,i)})}on(e,t){this._checkDisposed();let i=this._settingEvents[e];return i===void 0&&(i=this._settingEvents[e]=[]),i.push(t),new p(()=>{_(i,t),i.length===0&&delete this._settingEvents[e]})}onPrivate(e,t){this._checkDisposed();let i=this._privateSettingEvents[e];return i===void 0&&(i=this._privateSettingEvents[e]=[]),i.push(t),new p(()=>{_(i,t),i.length===0&&delete this._privateSettingEvents[e]})}_apply(e,t){this._checkDisposed();const i=[];return u(this._settingEvents,(n,r)=>{l(r,o=>{i.push(e.on(n,o))})}),u(this._privateSettingEvents,(n,r)=>{l(r,o=>{i.push(e.onPrivate(n,o))})}),this.states._apply(e,t),i.push(this.adapters._apply(e)),i.push(e.events.copyFrom(this.events)),new T(i)}_setObjectTemplate(e){this._checkDisposed(),this._entities.push(e)}_removeObjectTemplate(e){D(this._entities,e)}_stateChanged(e){this._checkDisposed(),this._entities.forEach(t=>{t._applyStateByKey(e)})}}class Le{constructor(e,t){if(this._rules={},this._root=e,!t)throw new Error("You cannot use `new Class()`, instead use `Class.new()`")}static new(e){const t=new this(e,!0);return t.setupDefaultRules(),t}setupDefaultRules(){}_lookupRules(e){return this._rules[e]}ruleRaw(e,t=[]){let i=this._rules[e];i||(i=this._rules[e]=[]),t.sort(f);const{index:n,found:r}=j(i,o=>{const h=f(o.tags.length,t.length);return h===0?me(o.tags,t,f):h});if(r)return i[n].template;{const o=S.new({});return i.splice(n,0,{tags:t,template:o}),o}}rule(e,t=[]){return this.ruleRaw(e,t)}}export{Oe as A,Te as B,ke as C,p as D,we as E,Ee as F,Ce as G,m as H,de as I,j as J,y as K,I as L,T as M,Y as N,Se as O,V as P,he as Q,oe as R,me as S,S as T,M as U,F as V,k as W,L as a,H as b,fe as c,u as d,l as e,d as f,_e as g,b as h,C as i,_ as j,ce as k,q as l,K as m,$ as n,ne as o,ee as p,E as q,D as r,X as s,A as t,pe as u,f as v,a as w,B as x,Ae as y,Le as z};
