import{n as B,r as w,d as Y,c as p,O as ut,u as at,o as r,_ as U,t as H,a as h,F as P,y as G,k as S,v as nt,f as F,z as Vt,P as Nt,Q as Ht,S as Ot,i as Rt,j as Gt,m as R,b as bt,T as Ft,A as Wt,U as Zt}from"./index-t2dBj-RG.js";function qt(){const s=w(1),c=w(0),n=w(0),i=B(()=>`translate(${c.value}px, ${n.value}px) scale(${s.value})`);function m(d){const g=Math.min(2,Math.max(.5,d));s.value=g}function y(d){m(s.value+d)}function v(d,g,x){const D=s.value,E=Math.min(2,Math.max(.5,D+x));if(E===D)return;const L=(d-c.value)/D,z=(g-n.value)/D;s.value=E,c.value=d-L*E,n.value=g-z*E}function u(d,g){c.value+=d,n.value+=g}return{zoom:s,offsetX:c,offsetY:n,transformStyle:i,setZoom:m,zoomBy:y,zoomAt:v,panBy:u}}function Qt(){return{gridStyle:B(()=>({backgroundImage:`
      radial-gradient(circle, rgba(148, 163, 184, 0.55) 1px, transparent 0)
    `,backgroundSize:"24px 24px"}))}}const jt=Y({__name:"CanvasGrid",setup(s){const{gridStyle:c}=Qt();return(n,i)=>(r(),p("div",{class:"mst-canvas-grid",style:ut(at(c))},null,4))}}),Kt=U(jt,[["__scopeId","data-v-edcf722d"]]),Jt={class:"mst-canvas-card"},te=["value"],ee={key:1},ae=Y({__name:"CanvasTextElement",props:{text:{},editing:{type:Boolean}},emits:["update:text","blur"],setup(s,{emit:c}){const n=s,i=c;return(m,y)=>(r(),p("div",Jt,[n.editing?(r(),p("textarea",{key:0,class:"mst-canvas-card__input",value:n.text,onInput:y[0]||(y[0]=v=>i("update:text",v.target.value)),onBlur:y[1]||(y[1]=v=>i("blur"))},null,40,te)):(r(),p("p",ee,H(s.text),1))]))}}),ht=U(ae,[["__scopeId","data-v-7fa5e3b9"]]),ne={class:"mst-canvas-card"},se={class:"mst-canvas-list"},oe=["value","onInput"],ie={key:0,class:"mst-canvas-list__actions"},le=["disabled"],ue=["disabled"],xt=1,kt=10,ce=Y({__name:"CanvasListElement",props:{data:{},editing:{type:Boolean}},emits:["update:list","blur"],setup(s,{emit:c}){const n=s,i=c;function m(){n.data.listData.length>=kt||i("update:list",[...n.data.listData,"New item"])}function y(){n.data.listData.length<=xt||i("update:list",n.data.listData.slice(0,-1))}function v(u,d){const g=[...n.data.listData];g[u]=d,i("update:list",g)}return(u,d)=>(r(),p("div",ne,[h("ul",se,[s.editing?(r(!0),p(P,{key:0},G(s.data.listData,(g,x)=>(r(),p("li",{key:x},[h("input",{value:g,type:"text",class:"mst-canvas-list__input",onInput:D=>v(x,D.target.value)},null,40,oe)]))),128)):(r(!0),p(P,{key:1},G(s.data.listData,(g,x)=>(r(),p("li",{key:x},H(g),1))),128))]),s.editing?(r(),p("div",ie,[h("button",{type:"button",class:"mst-canvas-list__btn",disabled:s.data.listData.length>=kt,onClick:m}," + ",8,le),h("button",{type:"button",class:"mst-canvas-list__btn",disabled:s.data.listData.length<=xt,onClick:y}," − ",8,ue)])):S("",!0)]))}}),de=U(ce,[["__scopeId","data-v-e7dcec02"]]),re={class:"mst-canvas-card"},pe={class:"mst-canvas-task"},ve={class:"mst-canvas-task__row"},me=["checked"],fe=["value"],ye=Y({__name:"CanvasTaskElement",props:{data:{},editing:{type:Boolean}},emits:["update:task","blur"],setup(s,{emit:c}){const n=s,i=c;function m(){i("update:task",n.data.data,!n.data.checked)}function y(v){i("update:task",v,n.data.checked)}return(v,u)=>(r(),p("div",re,[h("div",pe,[h("label",ve,[h("input",{type:"checkbox",class:"mst-canvas-task__check",checked:s.data.checked,onChange:m},null,40,me),s.editing?(r(),p("input",{key:0,type:"text",class:"mst-canvas-task__input",value:s.data.data,onInput:u[0]||(u[0]=d=>y(d.target.value)),onBlur:u[1]||(u[1]=d=>i("blur"))},null,40,fe)):(r(),p("span",{key:1,class:nt(["mst-canvas-task__text",{"mst-canvas-task__text--done":s.data.checked}])},H(s.data.data),3))])])]))}}),ge=U(ye,[["__scopeId","data-v-84c07566"]]),_e={class:"mst-canvas-card mst-canvas-image"},be=["src"],he={key:1,class:"mst-canvas-image__upload"},xe={key:2,class:"mst-canvas-image__placeholder"},ke={key:3,class:"mst-canvas-image__replace"},we=Y({__name:"CanvasImageElement",props:{data:{},editing:{type:Boolean}},emits:["update:image","blur"],setup(s,{emit:c}){const n=c;function i(m){const y=m.target,v=y.files?.[0];if(!v||!v.type.startsWith("image/"))return;const u=new FileReader;u.onload=()=>{const d=u.result;n("update:image",d)},u.readAsDataURL(v),y.value=""}return(m,y)=>(r(),p("div",_e,[s.data.base64File?(r(),p("img",{key:0,src:s.data.base64File,alt:"",class:"mst-canvas-image__img"},null,8,be)):s.editing?(r(),p("label",he,[h("input",{type:"file",accept:"image/*",class:"mst-canvas-image__input",onChange:i},null,32),y[0]||(y[0]=F(" Upload image ",-1))])):(r(),p("p",xe,"Image (double‑click to upload)")),s.editing&&s.data.base64File?(r(),p("label",ke,[h("input",{type:"file",accept:"image/*",class:"mst-canvas-image__input",onChange:i},null,32),y[1]||(y[1]=F(" Replace ",-1))])):S("",!0)]))}}),Te=U(we,[["__scopeId","data-v-36238fc7"]]),$e={class:"mst-canvas-card mst-canvas-audio"},Ie=["src"],De={key:1,class:"mst-canvas-audio__upload"},Me={key:2,class:"mst-canvas-audio__placeholder"},Ce={key:3,class:"mst-canvas-audio__replace"},Ee=Y({__name:"CanvasAudioElement",props:{data:{},editing:{type:Boolean}},emits:["update:audio","blur"],setup(s,{emit:c}){const n=c;function i(m){const y=m.target,v=y.files?.[0];if(!v||!v.type.startsWith("audio/"))return;const u=new FileReader;u.onload=()=>{n("update:audio",u.result)},u.readAsDataURL(v),y.value=""}return(m,y)=>(r(),p("div",$e,[y[2]||(y[2]=h("p",{class:"mst-canvas-audio__label"},"♪ Audio",-1)),s.data.base64File?(r(),p("audio",{key:0,src:s.data.base64File,controls:"",class:"mst-canvas-audio__player"},null,8,Ie)):s.editing?(r(),p("label",De,[h("input",{type:"file",accept:"audio/*",class:"mst-canvas-audio__input",onChange:i},null,32),y[0]||(y[0]=F(" Upload audio ",-1))])):(r(),p("p",Me,"Double‑click to upload audio")),s.editing&&s.data.base64File?(r(),p("label",Ce,[h("input",{type:"file",accept:"audio/*",class:"mst-canvas-audio__input",onChange:i},null,32),y[1]||(y[1]=F(" Replace file ",-1))])):S("",!0)]))}}),ze=U(Ee,[["__scopeId","data-v-178a72bc"]]),Ae={class:"mst-canvas-card mst-canvas-video"},Pe=["value"],Ye={key:0,class:"mst-canvas-video__embed"},Xe=["src"],Be={key:1,class:"mst-canvas-video__url"},Se=Y({__name:"CanvasVideoElement",props:{data:{},editing:{type:Boolean}},emits:["update:video","blur"],setup(s,{emit:c}){const n=s,i=c;function m(v){if(!v?.trim())return null;const u=v.trim().match(/(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);if(u?.[1])return u[1];const d=v.trim().match(/(?:youtu\.be\/)([a-zA-Z0-9_-]{11})/);if(d?.[1])return d[1];const g=v.trim().match(/(?:youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/);return g?.[1]?g[1]:null}const y=B(()=>m(n.data.url));return(v,u)=>(r(),p("div",Ae,[u[2]||(u[2]=h("p",{class:"mst-canvas-video__label"},"▶ Video URL",-1)),s.editing?(r(),p("input",{key:0,type:"url",class:"mst-canvas-video__input",placeholder:"https://www.youtube.com/...",value:s.data.url,onInput:u[0]||(u[0]=d=>i("update:video",d.target.value)),onBlur:u[1]||(u[1]=d=>i("blur"))},null,40,Pe)):(r(),p(P,{key:1},[y.value?(r(),p("div",Ye,[h("iframe",{src:"https://www.youtube.com/embed/"+y.value,title:"YouTube video",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,Xe)])):(r(),p("p",Be,[s.data.url?(r(),p(P,{key:0},[F(H(s.data.url),1)],64)):(r(),p(P,{key:1},[F("Double‑click to set video URL")],64))]))],64))]))}}),Ue=U(Se,[["__scopeId","data-v-60696898"]]),Le={class:"mst-canvas-card mst-canvas-date"},Ve={class:"mst-canvas-date__field"},Ne=["value"],He={class:"mst-canvas-date__field"},Oe=["value"],Re={class:"mst-canvas-date__date"},Ge={class:"mst-canvas-date__data"},Fe={class:"mst-canvas-date__countdown"},We=Y({__name:"CanvasDateElement",props:{data:{},editing:{type:Boolean}},emits:["update:date","blur"],setup(s,{emit:c}){const n=s,i=c,m=B(()=>{const u=new Date(n.data.date),d=new Date;return d.setHours(0,0,0,0),u.setHours(0,0,0,0),Math.ceil((u.getTime()-d.getTime())/(1e3*60*60*24))});function y(u){i("update:date",u,n.data.data)}function v(u){i("update:date",n.data.date,u)}return(u,d)=>(r(),p("div",Le,[s.editing?(r(),p(P,{key:0},[h("label",Ve,[d[3]||(d[3]=h("span",{class:"mst-canvas-date__label"},"Date",-1)),h("input",{type:"date",class:"mst-canvas-date__input",value:s.data.date,onInput:d[0]||(d[0]=g=>y(g.target.value))},null,40,Ne)]),h("label",He,[d[4]||(d[4]=h("span",{class:"mst-canvas-date__label"},"Goal",-1)),h("input",{type:"text",class:"mst-canvas-date__input",value:s.data.data,placeholder:"Goal or description",onInput:d[1]||(d[1]=g=>v(g.target.value)),onBlur:d[2]||(d[2]=g=>i("blur"))},null,40,Oe)])],64)):(r(),p(P,{key:1},[h("p",Re,H(s.data.date),1),h("p",Ge,H(s.data.data),1),h("p",Fe,H(m.value>0?m.value+" days left":m.value===0?"Today":Math.abs(m.value)+" days ago"),1)],64))]))}}),Ze=U(We,[["__scopeId","data-v-25dff11d"]]),qe=Y({__name:"CanvasElementRenderer",props:{element:{},editing:{type:Boolean}},emits:["update:text","update:list","update:task","update:image","update:audio","update:video","update:date","blur"],setup(s,{emit:c}){const n=s,i=c;function m(v){switch(v.type){case"Text":return ht;case"List":return de;case"Task":return ge;case"Image":return Te;case"Audio":return ze;case"Video":return Ue;case"Date":return Ze;default:return ht}}function y(v){switch(v.type){case"Text":return{text:v.data,editing:n.editing,"onUpdate:text":u=>i("update:text",u),onBlur:()=>i("blur")};case"List":return{data:v.data,editing:n.editing,"onUpdate:list":u=>i("update:list",u),onBlur:()=>i("blur")};case"Task":return{data:v.data,editing:n.editing,"onUpdate:task":(u,d)=>i("update:task",u,d),onBlur:()=>i("blur")};case"Image":return{data:v.data,editing:n.editing,"onUpdate:image":u=>i("update:image",u),onBlur:()=>i("blur")};case"Audio":return{data:v.data,editing:n.editing,"onUpdate:audio":u=>i("update:audio",u),onBlur:()=>i("blur")};case"Video":return{data:v.data,editing:n.editing,"onUpdate:video":u=>i("update:video",u),onBlur:()=>i("blur")};case"Date":return{data:v.data,editing:n.editing,"onUpdate:date":(u,d)=>i("update:date",u,d),onBlur:()=>i("blur")};default:return{text:"",editing:!1}}}return(v,u)=>(r(),Vt(Ot(m(n.element)),Nt(Ht(y(n.element))),null,16))}}),Qe=["d"],je=["d"],Ke=["data-element-id","onPointerdown","onDblclick"],Je=["onPointerdown"],ta=["onPointerdown"],ea=["onPointerdown"],aa=["onClick"],na={class:"mst-canvas-element__body"},sa={key:0,class:"mst-canvas-zoom-buttons mst-canvas-zoom-buttons--mobile"},J=2e3,tt=2e3,oa=140,ia=80,et=10,la=350,ua=Y({__name:"CanvasViewport",props:{elements:{},readOnly:{type:Boolean},backgroundImage:{},backgroundColor:{},selectedAddType:{}},emits:["move","resize","edit","edit:list","edit:task","edit:image","edit:audio","edit:video","edit:date","delete","connect","add"],setup(s,{emit:c}){const n=s,i=c,m=w(null),{transformStyle:y,zoomAt:v,panBy:u,zoomBy:d,zoom:g,offsetX:x,offsetY:D}=qt(),E=w(null),L=w(null),z=w(null),b=w(null),f=w(0),l=w(0),$=w(!1),T=w(null),A=w(null),M=w(new Map),V=w(null),I=w(null),C=w(null),X=w(null),st=w(null),ot=w(0),Z=B(()=>n.elements.find(t=>t.id===E.value)||null),it=B(()=>n.elements.find(t=>t.id===L.value)||null),ct=B(()=>T.value?n.elements.find(t=>t.id===T.value):null);function q(t,e){const a=m.value;if(!a)return{x:0,y:0};const o=a.getBoundingClientRect(),_=t-o.left,k=e-o.top;return{x:(_-x.value)/g.value,y:(k-D.value)/g.value}}function W(t){return{x:t.position.x+t.size.x/2,y:t.position.y+t.size.y/2}}function dt(t,e){for(const a of[...n.elements].reverse()){const{position:o,size:_}=a;if(t>=o.x&&t<=o.x+_.x&&e>=o.y&&e<=o.y+_.y)return a}return null}function Tt(t,e){if(t===e)return!1;const a=n.elements.find(_=>_.id===t);return a?!a.connections.some(_=>_.target===e):!1}const Q=B(()=>{if(!T.value||!A.value)return null;const t=dt(A.value.x,A.value.y);return!t||!Tt(T.value,t.id)?null:t.id}),$t=B(()=>E.value!=null||L.value!=null||T.value!=null);function rt(t){if(!t.ctrlKey)return;t.preventDefault();const e=m.value;if(!e)return;const a=e.getBoundingClientRect(),o=t.clientX-a.left,_=t.clientY-a.top,k=t.deltaY>0?-.1:.1;v(o,_,k),lt()}function lt(){const t=m.value;if(!t)return;const e=t.getBoundingClientRect(),a=e.width-J*g.value,o=e.height-tt*g.value;x.value=Math.max(a,Math.min(0,x.value)),D.value=Math.max(o,Math.min(0,D.value))}function It(t){const e=q(t.clientX,t.clientY);dt(e.x,e.y)||(t.button===1||t.pointerType==="touch")&&(t.pointerType==="touch"?(M.value=new Map(M.value),M.value.set(t.pointerId,{clientX:t.clientX,clientY:t.clientY}),M.value.size===1?(V.value={x:t.clientX,y:t.clientY},I.value=n.selectedAddType?{x:e.x,y:e.y,clientX:t.clientX,clientY:t.clientY}:null):M.value.size===2&&(I.value=null)):(t.preventDefault(),$.value=!0,f.value=t.clientX,l.value=t.clientY))}function Dt(t){if(t.preventDefault(),n.readOnly)return;const e=t.dataTransfer?.getData("text/plain");if(!e)return;const{x:a,y:o}=q(t.clientX,t.clientY);i("add",{type:e,x:a,y:o})}function Mt(t,e){if(!(e.button!==0&&e.pointerType==="mouse")&&!n.readOnly&&z.value!==t){if(e.pointerType==="touch"){const a=new Map(M.value);a.set(e.pointerId,{clientX:e.clientX,clientY:e.clientY}),M.value=a,C.value={x:e.clientX,y:e.clientY},X.value=t;return}E.value=t,f.value=e.clientX,l.value=e.clientY}}function Ct(t,e){if(!(e.button!==0&&e.pointerType==="mouse")&&!n.readOnly){if(e.preventDefault(),e.stopPropagation(),X.value=null,e.pointerType==="touch"){const a=new Map(M.value);a.set(e.pointerId,{clientX:e.clientX,clientY:e.clientY}),M.value=a}E.value=t,f.value=e.clientX,l.value=e.clientY}}function Et(t,e){e.button!==0&&e.pointerType==="mouse"||n.readOnly||(e.preventDefault(),X.value=null,L.value=t,f.value=e.clientX,l.value=e.clientY)}function zt(t,e){if(e.button!==0&&e.pointerType==="mouse"||n.readOnly)return;e.preventDefault(),e.stopPropagation(),X.value=null,T.value=t;const a=q(e.clientX,e.clientY);A.value={x:a.x,y:a.y}}function pt(t){const e=q(t.clientX,t.clientY);if(t.pointerType==="touch"){const a=new Map(M.value);if(a.has(t.pointerId)&&(a.set(t.pointerId,{clientX:t.clientX,clientY:t.clientY}),M.value=a),a.size===2){const o=Array.from(a.values()),_=o[0],k=o[1];if(!_||!k)return;const N=Math.hypot(k.clientX-_.clientX,k.clientY-_.clientY),O=(_.clientX+k.clientX)/2,Bt=(_.clientY+k.clientY)/2,gt=m.value;if(gt){const _t=gt.getBoundingClientRect(),St=O-_t.left,Ut=Bt-_t.top,K=window._pinchPrevDist;if(K!=null&&K>0){const Lt=(N-K)/K*.5;v(St,Ut,Lt),lt()}window._pinchPrevDist=N}I.value=null;return}if(a.size===1&&V.value){const o=Math.abs(t.clientX-V.value.x),_=Math.abs(t.clientY-V.value.y);(o>et||_>et)&&($.value||($.value=!0,f.value=V.value.x,l.value=V.value.y),I.value=null)}if(X.value&&C.value){const o=Math.abs(t.clientX-C.value.x),_=Math.abs(t.clientY-C.value.y);(o>et||_>et)&&(X.value=null)}}if($.value){const a=t.clientX-f.value,o=t.clientY-l.value;f.value=t.clientX,l.value=t.clientY,u(a,o),lt();return}if(T.value!==null){A.value={x:e.x,y:e.y};return}if(E.value&&Z.value){const a=(t.clientX-f.value)/g.value,o=(t.clientY-l.value)/g.value;f.value=t.clientX,l.value=t.clientY;const _=Z.value.position,k=Z.value.size,N=Math.min(J-k.x,Math.max(0,_.x+a)),O=Math.min(tt-k.y,Math.max(0,_.y+o));i("move",{id:Z.value.id,x:N,y:O});return}if(L.value&&it.value){const a=(t.clientX-f.value)/g.value,o=(t.clientY-l.value)/g.value;f.value=t.clientX,l.value=t.clientY;const{position:_,size:k}=it.value,N=Math.min(J-_.x,Math.max(oa,k.x+a)),O=Math.min(tt-_.y,Math.max(ia,k.y+o));i("resize",{id:it.value.id,width:Math.round(N),height:Math.round(O)})}}function j(t){if(t.pointerType==="touch"){const e=new Map(M.value);if(e.delete(t.pointerId),M.value=e,e.size<2&&(window._pinchPrevDist=void 0),e.size===0&&(V.value=null,I.value&&n.selectedAddType&&i("add",{type:n.selectedAddType,x:I.value.x,y:I.value.y}),I.value=null,X.value)){const a=X.value;X.value=null;const o=Date.now();st.value===a&&o-ot.value<la?(z.value=a,b.value=null,setTimeout(()=>{const _=m.value?.querySelector(`[data-element-id="${a}"]`);b.value=_},0),st.value=null,ot.value=0):(st.value=a,ot.value=o)}}else X.value=null;if(T.value!==null&&(t.button===0||t.pointerType==="touch")){const e=Q.value;e&&i("connect",{self:T.value,target:e}),T.value=null,A.value=null}C.value=null,E.value=null,L.value=null,$.value=!1}function At(t){n.readOnly||(z.value=t,b.value=null,setTimeout(()=>{const e=m.value?.querySelector(`[data-element-id="${t}"]`);b.value=e},0))}function Pt(t,e){i("edit",{id:t,text:e})}function Yt(){z.value=null,b.value=null}function Xt(t){i("delete",t)}function vt(t,e,a,o){const _=(t+a)/2,k=(e+o)/2,N=_+(o-e)*.2,O=k-(a-t)*.2;return`M ${t} ${e} Q ${N} ${O} ${a} ${o}`}function mt(t){const e=n.elements.find(k=>k.id===t.self),a=n.elements.find(k=>k.id===t.target);if(!e||!a)return null;const o=W(e),_=W(a);return vt(o.x,o.y,_.x,_.y)}const ft=B(()=>{if(!ct.value||!A.value)return null;const t=Q.value?n.elements.find(_=>_.id===Q.value):null,e=t?W(t).x:A.value.x,a=t?W(t).y:A.value.y,o=W(ct.value);return vt(o.x,o.y,e,a)});function yt(t){if(z.value==null)return;const e=t.target;b.value?.contains(e)||(z.value=null,b.value=null)}return Rt(()=>{window.addEventListener("pointerup",j),window.addEventListener("pointercancel",j),window.addEventListener("pointermove",pt),document.addEventListener("pointerdown",yt,!0);const t=m.value;t&&t.addEventListener("wheel",rt,{passive:!1})}),Gt(()=>{window.removeEventListener("pointerup",j),window.removeEventListener("pointercancel",j),window.removeEventListener("pointermove",pt),document.removeEventListener("pointerdown",yt,!0);const t=m.value;t&&t.removeEventListener("wheel",rt)}),(t,e)=>(r(),p("div",{ref_key:"viewportRef",ref:m,class:nt(["mst-canvas-viewport",{"mst-canvas-viewport--moving-resizing-connecting":$t.value,"mst-canvas-viewport--readonly":s.readOnly}]),onPointerdown:It,onDragover:e[2]||(e[2]=R(()=>{},["prevent"])),onDrop:Dt},[h("div",{class:"mst-canvas-inner",style:ut({transform:at(y),backgroundColor:n.backgroundColor??void 0,backgroundImage:n.backgroundImage?`url(${n.backgroundImage})`:void 0,backgroundSize:n.backgroundImage?"100% 100%":void 0,backgroundPosition:n.backgroundImage?"0 0":void 0,backgroundRepeat:n.backgroundImage?"no-repeat":void 0})},[bt(Kt),(r(),p("svg",{class:"mst-canvas-connections",width:J,height:tt},[e[3]||(e[3]=Ft('<defs data-v-42ed1340><filter id="mst-connection-glow" x="-20%" y="-20%" width="140%" height="140%" data-v-42ed1340><feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur" data-v-42ed1340></feGaussianBlur><feMerge data-v-42ed1340><feMergeNode in="blur" data-v-42ed1340></feMergeNode><feMergeNode in="SourceGraphic" data-v-42ed1340></feMergeNode></feMerge></filter><linearGradient id="mst-connection-stroke" x1="0%" y1="0%" x2="100%" y2="0%" data-v-42ed1340><stop offset="0%" stop-color="var(--mst-color-accent)" stop-opacity="0.7" data-v-42ed1340></stop><stop offset="100%" stop-color="var(--mst-color-surface-border)" stop-opacity="1" data-v-42ed1340></stop></linearGradient></defs>',1)),(r(!0),p(P,null,G(n.elements,a=>(r(),p("g",{key:"conn-"+a.id},[(r(!0),p(P,null,G(a.connections,o=>Wt((r(),p("path",{key:o.self+"-"+o.target,d:mt(o),class:"mst-canvas-connection-path",fill:"none"},null,8,Qe)),[[Zt,mt(o)]])),128))]))),128)),ft.value?(r(),p("path",{key:0,d:ft.value,class:"mst-canvas-connection-draft",fill:"none"},null,8,je)):S("",!0)])),(r(!0),p(P,null,G(n.elements,a=>(r(),p("div",{key:a.id,"data-element-id":a.id,class:nt(["mst-canvas-element-wrapper",{"mst-canvas-element--connect-target":Q.value===a.id}]),style:ut({left:a.position.x+"px",top:a.position.y+"px",width:a.size.x+"px",height:a.size.y+"px"}),onPointerdown:R(o=>Mt(a.id,o),["stop"]),onDblclick:R(o=>At(a.id),["stop"])},[s.readOnly?S("",!0):(r(),p("button",{key:0,type:"button",class:"mst-canvas-element__move",title:"Move","aria-label":"Move element",onPointerdown:R(o=>Ct(a.id,o),["stop"])}," ⋮⋮ ",40,Je)),s.readOnly?S("",!0):(r(),p("div",{key:1,class:"mst-canvas-element__connect-handle",title:"Drag to connect",onPointerdown:R(o=>zt(a.id,o),["stop"])},null,40,ta)),s.readOnly?S("",!0):(r(),p("div",{key:2,class:"mst-canvas-element__resize",onPointerdown:R(o=>Et(a.id,o),["stop","prevent"])},null,40,ea)),s.readOnly?S("",!0):(r(),p("button",{key:3,class:"mst-canvas-element__delete",type:"button",onClick:R(o=>Xt(a.id),["stop"]),title:"Delete"}," × ",8,aa)),h("div",na,[bt(qe,{element:a,editing:z.value===a.id,"onUpdate:text":o=>Pt(a.id,o),"onUpdate:list":o=>i("edit:list",{id:a.id,listData:o}),"onUpdate:task":(o,_)=>i("edit:task",{id:a.id,data:o,checked:_}),"onUpdate:image":o=>i("edit:image",{id:a.id,base64File:o}),"onUpdate:audio":o=>i("edit:audio",{id:a.id,base64File:o}),"onUpdate:video":o=>i("edit:video",{id:a.id,url:o}),"onUpdate:date":(o,_)=>i("edit:date",{id:a.id,date:o,data:_}),onBlur:Yt},null,8,["element","editing","onUpdate:text","onUpdate:list","onUpdate:task","onUpdate:image","onUpdate:audio","onUpdate:video","onUpdate:date"])])],46,Ke))),128))],4),s.readOnly?S("",!0):(r(),p("div",sa,[h("button",{type:"button",class:"mst-canvas-zoom-btn","aria-label":"Zoom in",onClick:e[0]||(e[0]=a=>at(d)(.2))},"+"),h("button",{type:"button",class:"mst-canvas-zoom-btn","aria-label":"Zoom out",onClick:e[1]||(e[1]=a=>at(d)(-.2))},"−")]))],34))}}),xa=U(ua,[["__scopeId","data-v-42ed1340"]]),ca={key:0,class:"mst-canvas-toolbar"},da=["onDragstart","onClick"],ra=["src","alt"],pa={class:"mst-canvas-toolbar__label"},va=Y({__name:"CanvasToolbar",props:{readOnly:{type:Boolean},selectedAddType:{}},emits:["update:selectedAddType"],setup(s,{emit:c}){const n=s,i=c,m="/MyStoryTeamV3/",y=[{type:"Text",label:"Text",icon:`${m}assets/icons/text-icon.svg`},{type:"List",label:"List",icon:`${m}assets/icons/list-icon.svg`},{type:"Task",label:"Task",icon:`${m}assets/icons/task-icon.svg`},{type:"Image",label:"Image",icon:`${m}assets/icons/image-icon.svg`},{type:"Audio",label:"Audio",icon:`${m}assets/icons/audio-icon.svg`},{type:"Video",label:"Video",icon:`${m}assets/icons/video-icon.svg`},{type:"Date",label:"Date",icon:`${m}assets/icons/date-icon.svg`}];function v(d,g){g.dataTransfer?.setData("text/plain",d),g.dataTransfer.effectAllowed="copy";const x=document.createElement("div");x.className="mst-drag-ghost",x.textContent=d,x.style.cssText=`
    position: absolute; left: -9999px; top: 0;
    padding: 8px 14px; border-radius: 10px;
    border: 2px solid rgba(68, 211, 255, 0.8);
    background: rgba(31, 41, 55, 0.85);
    color: #e0f7ff; font-size: 12px; font-weight: 600;
    pointer-events: none; white-space: nowrap;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  `,document.body.appendChild(x),g.dataTransfer?.setDragImage(x,24,16),requestAnimationFrame(()=>x.remove())}function u(d){const g=n.selectedAddType===d.type?null:d.type;i("update:selectedAddType",g)}return(d,g)=>s.readOnly?S("",!0):(r(),p("aside",ca,[(r(),p(P,null,G(y,x=>h("button",{key:x.type,class:nt(["mst-canvas-toolbar__item",{"mst-canvas-toolbar__item--selected":n.selectedAddType===x.type}]),draggable:"true",type:"button",onDragstart:D=>v(x.type,D),onClick:D=>u(x)},[h("img",{src:x.icon,alt:x.label,class:"mst-canvas-toolbar__icon"},null,8,ra),h("span",pa,H(x.label),1)],42,da)),64))]))}}),ka=U(va,[["__scopeId","data-v-e99d3aa1"]]),ma=140,fa=80,ya=480,ga=320,_a=2e3,ba=2e3;function wt(s){return{x:Math.min(ya,Math.max(ma,s.x)),y:Math.min(ga,Math.max(fa,s.y))}}function wa(s){const c=w([...s]);function n(b,f){c.value=c.value.map(l=>l.id===b?{...l,...f}:l)}function i(b,f){n(b,{position:f})}function m(b,f){n(b,{size:wt(f)})}function y(b,f){c.value=c.value.map(l=>l.id!==b?l:l.type==="Text"?{...l,data:f}:l)}function v(b,f){c.value=c.value.map(l=>l.id!==b||l.type!=="List"?l:{...l,data:{listData:f}})}function u(b,f,l){c.value=c.value.map($=>$.id!==b||$.type!=="Task"?$:{...$,data:{data:f,checked:l}})}function d(b,f){c.value=c.value.map(l=>l.id!==b||l.type!=="Image"?l:{...l,data:{base64File:f}})}function g(b,f){c.value=c.value.map(l=>l.id!==b||l.type!=="Audio"?l:{...l,data:{base64File:f}})}function x(b,f){c.value=c.value.map(l=>l.id!==b||l.type!=="Video"?l:{...l,data:{url:f}})}function D(b,f,l){c.value=c.value.map($=>$.id!==b||$.type!=="Date"?$:{...$,data:{date:f,data:l}})}function E(b){c.value=c.value.filter(f=>f.id!==b).map(f=>({...f,connections:f.connections.filter(l=>l.self!==b&&l.target!==b)}))}function L(b,f){b!==f&&(c.value=c.value.map(l=>l.id!==b||l.connections.some(T=>T.self===b&&T.target===f)?l:{...l,connections:[...l.connections,{self:b,target:f}]}))}function z(b,f,l){const T=wt({x:220,y:100}),A=Math.min(_a-T.x,Math.max(0,f-T.x/2)),M=Math.min(ba-T.y,Math.max(0,l-T.y/2)),I={id:`el_${Math.random().toString(36).slice(2,9)}`,position:{x:A,y:M,z:0},size:T,connections:[]};let C;switch(b){case"Text":C={...I,type:"Text",data:"New note"};break;case"List":C={...I,type:"List",data:{listData:["Item 1","Item 2"]}};break;case"Task":C={...I,type:"Task",data:{data:"New task",checked:!1}};break;case"Image":C={...I,type:"Image",data:{base64File:""}};break;case"Audio":C={...I,type:"Audio",data:{base64File:""}};break;case"Video":C={...I,type:"Video",data:{url:""}};break;case"Date":C={...I,type:"Date",data:{date:new Date().toISOString().slice(0,10),data:"Goal"}};break;default:C={...I,type:"Text",data:"New note"}}c.value=[...c.value,C]}return{elements:c,updateElement:n,updatePosition:i,updateSize:m,updateText:y,updateList:v,updateTask:u,updateImage:d,updateAudio:g,updateVideo:x,updateDate:D,removeElement:E,addConnection:L,addElement:z}}export{ka as C,xa as a,wa as u};
