import{d as M,H as L,p as U,i as $,x as z,o,c as r,a as n,v as y,u as s,t as l,k as g,F as f,y as A,A as I,D as N,E as R,z as j,I as F,f as K,m as q,r as u,n as G,G as Q,_ as S,b as Y}from"./index-DRMhAQNZ.js";import{a as J}from"./useMediaQuery-Bx2_Ol7Q.js";const O={class:"mst-ai-helper"},W=["disabled"],X={key:0,class:"mst-ai-helper__error"},Z={key:1,class:"mst-ai-helper__loading"},ee={key:2,class:"mst-ai-helper__empty"},te=["onClick"],se={class:"mst-ai-helper__item-name"},ne={key:0,class:"mst-ai-helper__placeholder"},ae={key:1,class:"mst-ai-helper__thread"},oe={class:"mst-ai-helper__thread-header"},ie={class:"mst-ai-helper__thread-name"},re={key:0,class:"mst-ai-helper__loading"},le={key:1,class:"mst-ai-helper__empty-thread"},ce={key:2,class:"mst-ai-helper__messages"},de={class:"mst-ai-helper__bubble-role"},ue={class:"mst-ai-helper__bubble-content"},_e={class:"mst-ai-helper__compose-row"},pe=["disabled"],he=["disabled"],ve={key:0,class:"mst-ai-helper__send-error"},me=M({__name:"AiHelperPanel",setup(H){const e=L(),_=J("(max-width: 768px)"),c=U(),p=u(""),k=u(null),h=u(null),v=u(""),m=u(!1),d=u(""),b=G(()=>[...e.conversations]);function w(t){return e.getConversationDisplayName(t.id,"Conversation")}function B(){const t=e.currentConversation;if(!t)return;const i=e.getConversationDisplayName(t.id,"Conversation");h.value=t.id,v.value=i}async function x(){const t=h.value,i=v.value.trim();if(t==null||!i){h.value=null;return}const a=await e.updateConversationTitle(t,i);h.value=null,a||(v.value="")}async function V(t){await e.selectConversation(t)}async function T(){if(!m.value){d.value="",m.value=!0;try{if(c.isAuthenticated&&!c.user?.id&&await c.refreshUser(),!c.user?.id){d.value="Please sign in to create a conversation.";return}await e.createConversation("New conversation")||(d.value="Could not create conversation. Please try again.")}catch{d.value="Could not create conversation. Please try again."}finally{m.value=!1}}}async function E(){const t=p.value.trim();if(!t||e.sending)return;await e.sendMessage(t)&&(p.value="")}function C(t){return t.type==="response"||t.type==="assistant"}function D(t){return t.type==="request"||t.type==="user"}function P(t){return C(t)?"AI":"You"}return $(async()=>{c.isAuthenticated&&!c.user?.id&&await c.refreshUser(),await e.loadConversations()}),z(()=>e.messages,()=>{Q(()=>{const t=k.value;if(!t)return;t.scrollHeight-t.scrollTop-t.clientHeight<100&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},{flush:"post"}),(t,i)=>(o(),r("div",O,[i[5]||(i[5]=n("header",{class:"mst-ai-helper__header"},[n("h2",{class:"mst-ai-helper__title"},"AI Helper"),n("p",{class:"mst-ai-helper__subtitle"},"Planning assistant powered by AI.")],-1)),n("div",{class:y(["mst-ai-helper__layout",{"mst-ai-helper__layout--mobile-thread":s(_)&&s(e).currentConversationId!=null}])},[n("aside",{class:y(["mst-ai-helper__list",{"mst-ai-helper__list--hidden":s(_)&&s(e).currentConversationId!=null}])},[n("button",{type:"button",class:"mst-ai-helper__new-btn",disabled:m.value,onClick:T},l(m.value?"Creating…":"+ New conversation"),9,W),d.value?(o(),r("p",X,l(d.value),1)):g("",!0),s(e).loading&&b.value.length===0?(o(),r("p",Z," Loading… ")):b.value.length===0?(o(),r("p",ee," No conversations yet. ")):g("",!0),(o(!0),r(f,null,A(b.value,a=>(o(),r("button",{key:a.id,type:"button",class:y(["mst-ai-helper__item",{"mst-ai-helper__item--active":s(e).currentConversationId===a.id}]),onClick:be=>V(a.id)},[n("span",se,l(w(a)),1)],10,te))),128))],2),n("main",{class:y(["mst-ai-helper__panel",{"mst-ai-helper__panel--hidden":s(_)&&s(e).currentConversationId==null}])},[s(e).currentConversationId==null?(o(),r("p",ne," Select or create a conversation ")):(o(),r("div",ae,[n("header",oe,[s(_)?(o(),r("button",{key:0,type:"button",class:"mst-ai-helper__back-btn","aria-label":"Back to conversations",onClick:i[0]||(i[0]=(...a)=>s(e).backToConversations&&s(e).backToConversations(...a))},[...i[3]||(i[3]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[n("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)])])):g("",!0),h.value===s(e).currentConversationId?I((o(),r("input",{key:1,"onUpdate:modelValue":i[1]||(i[1]=a=>v.value=a),type:"text",class:"mst-ai-helper__thread-name-input",placeholder:"Conversation name",onBlur:x,onKeydown:R(x,["enter"])},null,544)),[[N,v.value]]):(o(),r(f,{key:2},[n("span",ie,l(s(e).currentConversation&&w(s(e).currentConversation)),1),n("button",{type:"button",class:"mst-ai-helper__thread-edit",title:"Edit conversation name",onClick:B},[...i[4]||(i[4]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[n("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),n("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])])],64))]),n("div",{class:"mst-ai-helper__thread-content",ref_key:"messagesContainerRef",ref:k},[s(e).loading&&s(e).messages.length===0?(o(),r("p",re," Loading messages… ")):s(e).messages.length===0?(o(),r("p",le," No messages yet. Start the conversation! ")):(o(),r("div",ce,[(o(!0),r(f,null,A(s(e).messages,a=>(o(),r("div",{key:a.id,class:y(["mst-ai-helper__bubble",{"mst-ai-helper__bubble--ai":C(a),"mst-ai-helper__bubble--own":D(a)}])},[n("span",de,l(P(a)),1),n("span",ue,[C(a)?(o(),j(F,{key:0,content:a.content,animate:s(e).messages[s(e).messages.length-1]?.id===a.id},null,8,["content","animate"])):(o(),r(f,{key:1},[K(l(a.content),1)],64))])],2))),128))]))],512),n("form",{class:"mst-ai-helper__compose",onSubmit:q(E,["prevent"])},[n("div",_e,[I(n("input",{"onUpdate:modelValue":i[2]||(i[2]=a=>p.value=a),type:"text",class:"mst-ai-helper__input",placeholder:"Ask about tasks, canvases, or planning…",maxlength:"4000",disabled:s(e).sending},null,8,pe),[[N,p.value]]),n("button",{type:"submit",class:"mst-ai-helper__send",disabled:!p.value.trim()||s(e).sending},l(s(e).sending?"Sending…":"Send"),9,he)]),s(e).sendError?(o(),r("p",ve,l(s(e).sendError),1)):g("",!0)],32)]))],2)],2)]))}}),ye=S(me,[["__scopeId","data-v-812612a1"]]),ge={class:"mst-ai-helper-view"},fe=M({__name:"AiHelperView",setup(H){return(e,_)=>(o(),r("div",ge,[Y(ye)]))}}),we=S(fe,[["__scopeId","data-v-d545162e"]]);export{we as default};
