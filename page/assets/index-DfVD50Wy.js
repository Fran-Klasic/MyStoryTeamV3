const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PublicLayout-_jIejmp1.js","assets/vendor-CYnaoYaV.js","assets/PublicLayout-BbBoZkCS.css","assets/HomeView-DM66daBk.js","assets/MstCard-DOMq7TXY.js","assets/MstCard-BjCVkCoB.css","assets/PageSection-CITIiNTe.js","assets/PageSection-FGVT2Yhw.css","assets/HomeView-BX6pz4F_.css","assets/DiscoverView-Ba7hbYOH.js","assets/useCanvasElements-CPJHmUxy.js","assets/useCanvasElements-CCThYfUO.css","assets/DiscoverView-nwmpblCZ.css","assets/WalkthroughView-4E0wX2Qw.js","assets/WalkthroughView-D18r8lV-.css","assets/SignInView-BsQyR0o4.js","assets/MstInput-ChGRBqn0.js","assets/MstInput-B0m39jMH.css","assets/SignInView-BMYHw4km.css","assets/RegisterView-D3JYeYi2.js","assets/RegisterView-BEbc2Uwr.css","assets/AppLayout-BeHUtcD2.js","assets/canvas.store-DR8ZLaIk.js","assets/useMediaQuery-DS4tgulC.js","assets/AppLayout-Dfq4z9iR.css","assets/DashboardView-BFsBQ7Fc.js","assets/CanvasCard-BGRV4MtE.js","assets/CanvasCard-MRKK2HHy.css","assets/DashboardView-DrJD8wvV.css","assets/BrowseView-DwBGMmjU.js","assets/BrowseView-C67rmOdX.css","assets/MessagesView-BChkUF7h.js","assets/user.service-Qi1RfXeL.js","assets/MessagesView-ptI_a4lK.css","assets/AiHelperView-CWMw5U3Z.js","assets/AiHelperView-CtvNfFcN.css","assets/ProfileView-B0k36VyX.js","assets/ProfileView-CiX-88F5.css","assets/CanvasEditorView-BCGSjwqK.js","assets/CanvasEditorView-D3N3hYrO.css"])))=>i.map(i=>d[i]);
import{d as Q,r as v,c as K,a as T,b as k,n as z,e as ae,o as g,w as H,f as re,t as C,g as x,u as A,h as y,F as N,i as oe,j as V,k as B,l as ie,m as ce,v as ue,p as S,q as le,T as de,s as pe,x as fe,R as me,y as he,z as _e,A as ve,B as ye}from"./vendor-CYnaoYaV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const W="https://mystoryteamapi.azurewebsites.net",q="mst_access_token";let E=(()=>{try{return localStorage.getItem(q)}catch{return null}})();function I(e){E=e;try{e?localStorage.setItem(q,e):localStorage.removeItem(q)}catch{}}function J(){return E}let L=null;function ge(e){L=e}async function b(e,t={}){const{body:n,headers:a,...r}=t,o=new Headers(a);n!=null&&(o.has("Content-Type")||o.set("Content-Type","application/json")),E&&o.set("Authorization",`Bearer ${E}`);const i=e.startsWith("http")?e:`${W}${e}`,s=await fetch(i,{...r,headers:o,body:n!=null?JSON.stringify(n):void 0});if(!s.ok){s.status===401&&L&&L();const u=await s.text();let _;try{const m=JSON.parse(u);_=m.message??m.error??u}catch{_=u||s.statusText}throw new Error(_)}if(s.headers.get("Content-Type")?.includes("application/json"))return s.json();const c=await s.text();if(c!=null&&c.trim()){const u=c.trim();if(u.startsWith("{")||u.startsWith("["))try{return JSON.parse(c)}catch{return u}return u}}function Ae(e){if(!e)return null;const t=e.ID_User??e.iD_User;return t==null?null:{id:String(t),username:(e.Username??e.username??"").trim()||"User",email:(e.Email??e.email??"").trim()||"",bio:(e.Bio??e.bio??"").trim()||void 0}}async function F(e,t){const n=`${W}${e}`,a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const o=await a.text();let i;try{const s=JSON.parse(o);if(s.errors&&typeof s.errors=="object"){const l=Object.keys(s.errors)[0],c=l?s.errors[l]:null;Array.isArray(c)&&c.length>0?i=c[0]:i=s.title??s.message??s.error??o}else i=s.message??s.error??s.title??o}catch{i=o||a.statusText}throw new Error(i)}const r=(await a.text()).trim();if(!r)throw new Error("Login response did not contain a token.");return r}async function ke(e){const t=await F("/api/auth/login",e);I(t)}async function we(e){const t=await F("/api/auth/register",e);I(t)}async function be(){I(null)}async function P(){if(!J())return null;try{const e=await b("/api/auth/user",{method:"GET"});return Ae(e)}catch{return I(null),null}}const R=Q("auth",()=>{const e=v(null),t=K(()=>!!J());async function n(i,s){await ke({email:i,password:s});try{const l=await P();l&&(e.value=l)}catch{}return e.value}async function a(i,s,l,c){await we({username:i,email:s,password:l,repeatPassword:c});try{const u=await P();u&&(e.value=u)}catch{}return e.value}function r(){be(),e.value=null}async function o(){const i=await P();return e.value=i,i}return{user:e,isAuthenticated:t,login:n,register:a,logout:r,refreshUser:o}});function Ce(e){return{id:e.ID_AI_Conversation??e.iD_AI_Conversation??0,title:(e.Title??e.title??"").trim()||"Conversation"}}function Ee(e,t){return{id:e.ID_AI_Message??e.iD_AI_Message??0,conversationId:e.ID_AI_Conversation??e.iD_AI_Conversation??t,content:e.Content??e.content??"",type:e.Type??e.type??"user"}}async function Te(){const e=await b("/api/auth/ai",{method:"GET"});return(Array.isArray(e)?e:[]).map(Ce)}async function M(e){const t=await b(`/api/auth/ai/${e}`,{method:"GET"});return(Array.isArray(t)?t:[]).map(a=>Ee(a,e))}async function Ie(e,t){const n=await b("/api/auth/ai",{method:"POST",body:{ID_User:e,Title:(t??"").trim()||null}});return typeof n=="number"?n:0}async function Oe(e,t,n){const a=await b("/api/auth/ai/message",{method:"POST",body:{ID_AI_Conversation:e,Content:t.slice(0,4e3),Type:n}});return typeof a=="number"?a:0}async function De(e,t){try{return await b(`/api/auth/ai?id=${e}`,{method:"PUT",body:{ID_AI_Conversation:e,Title:t.trim()}}),!0}catch{return!1}}const G=Q("ai",()=>{const e=R(),t=v([]),n=v(null),a=v([]),r=v(!1),o=v(!1),i=v(null),s=v({}),l=v(!1),c=K(()=>{const d=n.value;return d==null?null:t.value.find(p=>p.id===d)??null});function u(d,p){return s.value[d]??p}async function _(){r.value=!0;try{const d=await Te();t.value=d;const p={};for(const f of d)f.title&&(p[f.id]=f.title);s.value=p}finally{r.value=!1}}async function m(d){n.value=d,r.value=!0;try{const p=await M(d);a.value=p;const f=t.value.find(w=>w.id===d);f?.title&&(s.value={...s.value,[d]:f.title})}finally{r.value=!1}}async function O(d){const p=e.user?.id;if(!p)return null;const f=parseInt(p,10);if(Number.isNaN(f))return null;r.value=!0;try{const w=await Ie(f,d);return w>0?(await _(),await m(w),w):null}finally{r.value=!1}}async function D(d,p){const f=await De(d,p);return f&&(s.value={...s.value,[d]:p.trim()}),f}async function X(d){const p=n.value;if(p==null)return i.value="Select or create a conversation first.",!1;const f=d.trim();if(!f)return!1;i.value=null,o.value=!0;try{if(await Oe(p,f,"user")>0){const se=await M(p);return a.value=se,!0}return i.value="Could not send message.",!1}catch{return i.value="Could not send message.",!1}finally{o.value=!1}}function Z(){l.value=!l.value}function ee(){l.value=!0}function te(){l.value=!1}function ne(){n.value=null}return{conversations:t,currentConversationId:n,currentConversation:c,messages:a,loading:r,sending:o,sendError:i,conversationTitlesByConvId:s,isQuickChatOpen:l,loadConversations:_,selectConversation:m,createConversation:O,updateConversationTitle:D,sendMessage:X,getConversationDisplayName:u,toggleQuickChat:Z,openQuickChat:ee,closeQuickChat:te,backToConversations:ne}}),Pe=["type","disabled"],Se=T({__name:"MstButton",props:{variant:{default:"primary"},type:{default:"button"},disabled:{type:Boolean,default:!1}},setup(e){const t=e;return(n,a)=>(g(),k("button",{type:t.type,class:z(["mst-btn",{"mst-btn--primary":t.variant==="primary","mst-btn--secondary":t.variant==="secondary","mst-btn--ghost":t.variant==="ghost"}]),disabled:t.disabled},[ae(n.$slots,"default")],10,Pe))}}),qe=T({__name:"AiMessageContent",props:{content:{},animate:{type:Boolean,default:!0},wordDelay:{default:45}},setup(e){const t=e,n=v("");let a=null;function r(o){if(a&&(clearInterval(a),a=null),n.value="",!t.animate||!o){n.value=o;return}const i=o.split(/\s+/).filter(Boolean);if(i.length===0){n.value=o;return}let s=0;a=setInterval(()=>{if(s>=i.length){a&&clearInterval(a),a=null;return}n.value=(n.value?n.value+" ":"")+i[s],s++},t.wordDelay)}return H(()=>t.content,r,{immediate:!0}),re(()=>{a&&clearInterval(a)}),(o,i)=>(g(),k("span",null,C(n.value),1))}}),Le={key:0,class:"mst-ai-quickchat"},Re={class:"mst-ai-quickchat__panel"},$e={class:"mst-ai-quickchat__history"},Ue={class:"mst-ai-quickchat__message-role"},xe={class:"mst-ai-quickchat__message-content"},Ne={key:0,class:"mst-ai-quickchat__placeholder"},Ve=["disabled"],Be=T({__name:"AiQuickChat",setup(e){const t=G(),n=v("");async function a(){const l=n.value.trim();if(!l||t.sending)return;await t.sendMessage(l)&&(n.value="")}function r(){t.closeQuickChat()}function o(l){return l.type==="response"||l.type==="assistant"}function i(l){return o(l)?"AI":"You"}function s(l){return o(l)?"ai":"user"}return H(()=>t.isQuickChatOpen,async l=>{if(l&&t.currentConversationId==null)if(await t.loadConversations(),t.conversations.length===0)await t.createConversation("Quick chat");else{const c=t.conversations[0];c&&await t.selectConversation(c.id)}}),(l,c)=>(g(),x(de,{to:"body"},[A(t).isQuickChatOpen?(g(),k("div",Le,[y("div",{class:"mst-ai-quickchat__backdrop",onClick:r}),y("div",Re,[y("header",{class:"mst-ai-quickchat__header"},[c[1]||(c[1]=y("h3",{class:"mst-ai-quickchat__title"},"AI Helper",-1)),y("button",{type:"button",class:"mst-ai-quickchat__close","aria-label":"Close",onClick:r}," × ")]),y("div",$e,[(g(!0),k(N,null,oe(A(t).messages,u=>(g(),k("div",{key:u.id,class:z(["mst-ai-quickchat__message","mst-ai-quickchat__message--"+s(u)])},[y("span",Ue,C(i(u)),1),y("p",xe,[o(u)?(g(),x(qe,{key:0,content:u.content,animate:A(t).messages[A(t).messages.length-1]?.id===u.id},null,8,["content","animate"])):(g(),k(N,{key:1},[V(C(u.content),1)],64))])],2))),128)),A(t).messages.length===0?(g(),k("p",Ne," Ask about tasks, canvases, or planning. ")):B("",!0)]),y("form",{class:"mst-ai-quickchat__form",onSubmit:ie(a,["prevent"])},[ce(y("input",{"onUpdate:modelValue":c[0]||(c[0]=u=>n.value=u),type:"text",class:"mst-ai-quickchat__input",placeholder:"Type a message…",disabled:A(t).sending},null,8,Ve),[[ue,n.value]]),S(Se,{type:"submit",variant:"primary",disabled:A(t).sending||!n.value.trim()},{default:le(()=>[V(C(A(t).sending?"…":"Send"),1)]),_:1},8,["disabled"])],32)])])):B("",!0)]))}}),Y=(e,t)=>{const n=e.__vccOpts||e;for(const[a,r]of t)n[a]=r;return n},Me=Y(Be,[["__scopeId","data-v-779d8f04"]]),je={class:"mst-app-root"},Qe=T({__name:"App",setup(e){const t=G();function n(a){(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),t.toggleQuickChat())}return pe(()=>{window.addEventListener("keydown",n)}),fe(()=>{window.removeEventListener("keydown",n)}),(a,r)=>(g(),k("div",je,[S(A(me)),S(Me)]))}}),Ke=Y(Qe,[["__scopeId","data-v-68ce2fca"]]),ze="modulepreload",He=function(e){return"/"+e},j={},h=function(t,n,a){let r=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=i?.nonce||i?.getAttribute("nonce");r=l(n.map(c=>{if(c=He(c),c in j)return;j[c]=!0;const u=c.endsWith(".css"),_=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${_}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":ze,u||(m.as="script"),m.crossOrigin="",m.href=c,s&&m.setAttribute("nonce",s),document.head.appendChild(m),u)return new Promise((O,D)=>{m.addEventListener("load",O),m.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return r.then(i=>{for(const s of i||[])s.status==="rejected"&&o(s.reason);return t().catch(o)})},We=[{path:"/",component:()=>h(()=>import("./PublicLayout-_jIejmp1.js"),__vite__mapDeps([0,1,2])),children:[{path:"",name:"home",component:()=>h(()=>import("./HomeView-DM66daBk.js"),__vite__mapDeps([3,1,4,5,6,7,8]))},{path:"discover",name:"discover",component:()=>h(()=>import("./DiscoverView-Ba7hbYOH.js"),__vite__mapDeps([9,10,1,11,12]))},{path:"walkthrough",name:"walkthrough",component:()=>h(()=>import("./WalkthroughView-4E0wX2Qw.js"),__vite__mapDeps([13,6,1,7,4,5,14]))},{path:"auth/sign-in",name:"sign-in",component:()=>h(()=>import("./SignInView-BsQyR0o4.js"),__vite__mapDeps([15,1,16,17,18]))},{path:"auth/register",name:"register",component:()=>h(()=>import("./RegisterView-D3JYeYi2.js"),__vite__mapDeps([19,16,1,17,20]))}]},{path:"/app",component:()=>h(()=>import("./AppLayout-BeHUtcD2.js"),__vite__mapDeps([21,1,22,23,24])),children:[{path:"dashboard",name:"dashboard",component:()=>h(()=>import("./DashboardView-BFsBQ7Fc.js"),__vite__mapDeps([25,1,26,27,22,28])),meta:{requiresAuth:!0,title:"Dashboard",section:"Dashboard"}},{path:"browse",name:"browse",component:()=>h(()=>import("./BrowseView-DwBGMmjU.js"),__vite__mapDeps([29,1,26,27,22,30])),meta:{requiresAuth:!0,title:"Browse",section:"Browse"}},{path:"messages",name:"messages",component:()=>h(()=>import("./MessagesView-BChkUF7h.js"),__vite__mapDeps([31,1,32,23,33])),meta:{requiresAuth:!0,title:"Messages",section:"Messages"}},{path:"ai-helper",name:"ai-helper",component:()=>h(()=>import("./AiHelperView-CWMw5U3Z.js"),__vite__mapDeps([34,1,23,35])),meta:{requiresAuth:!0,title:"AI Helper",section:"AI Helper"}},{path:"profile",name:"profile",component:()=>h(()=>import("./ProfileView-B0k36VyX.js"),__vite__mapDeps([36,4,1,5,32,22,37])),meta:{requiresAuth:!0,title:"Profile",section:"Profile"}},{path:"canvas/new",name:"canvas-new",component:()=>h(()=>import("./CanvasEditorView-BCGSjwqK.js"),__vite__mapDeps([38,1,10,11,22,39])),meta:{requiresAuth:!0}},{path:"canvas/:id",name:"canvas-editor",component:()=>h(()=>import("./CanvasEditorView-BCGSjwqK.js"),__vite__mapDeps([38,1,10,11,22,39])),meta:{requiresAuth:!0}}]}],$=he({history:_e("/"),routes:We,scrollBehavior(e){return e.hash?{el:e.hash,behavior:"smooth"}:{top:0,behavior:"smooth"}}});$.beforeEach(e=>{const t=R();if(e.meta.requiresAuth&&!t.isAuthenticated)return{path:"/auth/sign-in",query:{redirect:e.fullPath}};if(e.path.startsWith("/auth/")&&t.isAuthenticated)return{path:"/app/dashboard"}});const U=ve(Ke);U.use(ye());U.use($);ge(()=>{R().logout(),$.replace("/auth/sign-in")});U.mount("#app");export{W as A,Y as _,Se as a,G as b,qe as c,M as d,h as e,b as f,Te as g,J as h,Ae as m,R as u};
