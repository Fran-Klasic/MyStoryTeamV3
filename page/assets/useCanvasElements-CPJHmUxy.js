import{c as B,r as k,a as Y,b as p,K as ut,u as at,o as r,t as H,h,F as P,i as G,k as S,n as nt,j as F,g as Vt,L as Nt,M as Ht,N as Ot,s as Rt,x as Gt,l as R,p as bt,O as Ft,m as Wt,P as Zt}from"./vendor-CYnaoYaV.js";import{_ as L}from"./index-DfVD50Wy.js";function qt(){const s=k(1),c=k(0),n=k(0),l=B(()=>`translate(${c.value}px, ${n.value}px) scale(${s.value})`);function b(d){const v=Math.min(2,Math.max(.5,d));s.value=v}function y(d){b(s.value+d)}function m(d,v,I){const E=s.value,C=Math.min(2,Math.max(.5,E+I));if(C===E)return;const U=(d-c.value)/E,z=(v-n.value)/E;s.value=C,c.value=d-U*C,n.value=v-z*C}function i(d,v){c.value+=d,n.value+=v}return{zoom:s,offsetX:c,offsetY:n,transformStyle:l,setZoom:b,zoomBy:y,zoomAt:m,panBy:i}}function Kt(){return{gridStyle:B(()=>({backgroundImage:`
      radial-gradient(circle, rgba(148, 163, 184, 0.55) 1px, transparent 0)
    `,backgroundSize:"24px 24px"}))}}const jt=Y({__name:"CanvasGrid",setup(s){const{gridStyle:c}=Kt();return(n,l)=>(r(),p("div",{class:"mst-canvas-grid",style:ut(at(c))},null,4))}}),Qt=L(jt,[["__scopeId","data-v-edcf722d"]]),Jt={class:"mst-canvas-card"},te=["value"],ee={key:1},ae=Y({__name:"CanvasTextElement",props:{text:{},editing:{type:Boolean}},emits:["update:text","blur"],setup(s,{emit:c}){const n=s,l=c;return(b,y)=>(r(),p("div",Jt,[n.editing?(r(),p("textarea",{key:0,class:"mst-canvas-card__input",value:n.text,onInput:y[0]||(y[0]=m=>l("update:text",m.target.value)),onBlur:y[1]||(y[1]=m=>l("blur"))},null,40,te)):(r(),p("p",ee,H(s.text),1))]))}}),ht=L(ae,[["__scopeId","data-v-7fa5e3b9"]]),ne={class:"mst-canvas-card"},se={class:"mst-canvas-list"},oe=["value","onInput"],ie={key:0,class:"mst-canvas-list__actions"},le=["disabled"],ue=["disabled"],xt=1,kt=10,ce=Y({__name:"CanvasListElement",props:{data:{},editing:{type:Boolean}},emits:["update:list","blur"],setup(s,{emit:c}){const n=s,l=c;function b(){n.data.listData.length>=kt||l("update:list",[...n.data.listData,"New item"])}function y(){n.data.listData.length<=xt||l("update:list",n.data.listData.slice(0,-1))}function m(i,d){const v=[...n.data.listData];v[i]=d,l("update:list",v)}return(i,d)=>(r(),p("div",ne,[h("ul",se,[s.editing?(r(!0),p(P,{key:0},G(s.data.listData,(v,I)=>(r(),p("li",{key:I},[h("input",{value:v,type:"text",class:"mst-canvas-list__input",onInput:E=>m(I,E.target.value)},null,40,oe)]))),128)):(r(!0),p(P,{key:1},G(s.data.listData,(v,I)=>(r(),p("li",{key:I},H(v),1))),128))]),s.editing?(r(),p("div",ie,[h("button",{type:"button",class:"mst-canvas-list__btn",disabled:s.data.listData.length>=kt,onClick:b}," + ",8,le),h("button",{type:"button",class:"mst-canvas-list__btn",disabled:s.data.listData.length<=xt,onClick:y}," − ",8,ue)])):S("",!0)]))}}),de=L(ce,[["__scopeId","data-v-e7dcec02"]]),re={class:"mst-canvas-card"},pe={class:"mst-canvas-task"},ve={class:"mst-canvas-task__row"},me=["checked"],fe=["value"],ye=Y({__name:"CanvasTaskElement",props:{data:{},editing:{type:Boolean}},emits:["update:task","blur"],setup(s,{emit:c}){const n=s,l=c;function b(){l("update:task",n.data.data,!n.data.checked)}function y(m){l("update:task",m,n.data.checked)}return(m,i)=>(r(),p("div",re,[h("div",pe,[h("label",ve,[h("input",{type:"checkbox",class:"mst-canvas-task__check",checked:s.data.checked,onChange:b},null,40,me),s.editing?(r(),p("input",{key:0,type:"text",class:"mst-canvas-task__input",value:s.data.data,onInput:i[0]||(i[0]=d=>y(d.target.value)),onBlur:i[1]||(i[1]=d=>l("blur"))},null,40,fe)):(r(),p("span",{key:1,class:nt(["mst-canvas-task__text",{"mst-canvas-task__text--done":s.data.checked}])},H(s.data.data),3))])])]))}}),ge=L(ye,[["__scopeId","data-v-84c07566"]]),_e={class:"mst-canvas-card mst-canvas-image"},be=["src"],he={key:1,class:"mst-canvas-image__upload"},xe={key:2,class:"mst-canvas-image__placeholder"},ke={key:3,class:"mst-canvas-image__replace"},we=Y({__name:"CanvasImageElement",props:{data:{},editing:{type:Boolean}},emits:["update:image","blur"],setup(s,{emit:c}){const n=c;function l(b){const y=b.target,m=y.files?.[0];if(!m||!m.type.startsWith("image/"))return;const i=new FileReader;i.onload=()=>{const d=i.result;n("update:image",d)},i.readAsDataURL(m),y.value=""}return(b,y)=>(r(),p("div",_e,[s.data.base64File?(r(),p("img",{key:0,src:s.data.base64File,alt:"",class:"mst-canvas-image__img"},null,8,be)):s.editing?(r(),p("label",he,[h("input",{type:"file",accept:"image/*",class:"mst-canvas-image__input",onChange:l},null,32),y[0]||(y[0]=F(" Upload image ",-1))])):(r(),p("p",xe,"Image (double‑click to upload)")),s.editing&&s.data.base64File?(r(),p("label",ke,[h("input",{type:"file",accept:"image/*",class:"mst-canvas-image__input",onChange:l},null,32),y[1]||(y[1]=F(" Replace ",-1))])):S("",!0)]))}}),Te=L(we,[["__scopeId","data-v-36238fc7"]]),$e={class:"mst-canvas-card mst-canvas-audio"},Ie=["src"],De={key:1,class:"mst-canvas-audio__upload"},Me={key:2,class:"mst-canvas-audio__placeholder"},Ce={key:3,class:"mst-canvas-audio__replace"},Ee=Y({__name:"CanvasAudioElement",props:{data:{},editing:{type:Boolean}},emits:["update:audio","blur"],setup(s,{emit:c}){const n=c;function l(b){const y=b.target,m=y.files?.[0];if(!m||!m.type.startsWith("audio/"))return;const i=new FileReader;i.onload=()=>{n("update:audio",i.result)},i.readAsDataURL(m),y.value=""}return(b,y)=>(r(),p("div",$e,[y[2]||(y[2]=h("p",{class:"mst-canvas-audio__label"},"♪ Audio",-1)),s.data.base64File?(r(),p("audio",{key:0,src:s.data.base64File,controls:"",class:"mst-canvas-audio__player"},null,8,Ie)):s.editing?(r(),p("label",De,[h("input",{type:"file",accept:"audio/*",class:"mst-canvas-audio__input",onChange:l},null,32),y[0]||(y[0]=F(" Upload audio ",-1))])):(r(),p("p",Me,"Double‑click to upload audio")),s.editing&&s.data.base64File?(r(),p("label",Ce,[h("input",{type:"file",accept:"audio/*",class:"mst-canvas-audio__input",onChange:l},null,32),y[1]||(y[1]=F(" Replace file ",-1))])):S("",!0)]))}}),ze=L(Ee,[["__scopeId","data-v-178a72bc"]]),Ae={class:"mst-canvas-card mst-canvas-video"},Pe=["value"],Ye={key:0,class:"mst-canvas-video__embed"},Xe=["src"],Be={key:1,class:"mst-canvas-video__url"},Se=Y({__name:"CanvasVideoElement",props:{data:{},editing:{type:Boolean}},emits:["update:video","blur"],setup(s,{emit:c}){const n=s,l=c;function b(m){if(!m?.trim())return null;const i=m.trim().match(/(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);if(i?.[1])return i[1];const d=m.trim().match(/(?:youtu\.be\/)([a-zA-Z0-9_-]{11})/);if(d?.[1])return d[1];const v=m.trim().match(/(?:youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/);return v?.[1]?v[1]:null}const y=B(()=>b(n.data.url));return(m,i)=>(r(),p("div",Ae,[i[2]||(i[2]=h("p",{class:"mst-canvas-video__label"},"▶ Video URL",-1)),s.editing?(r(),p("input",{key:0,type:"url",class:"mst-canvas-video__input",placeholder:"https://www.youtube.com/...",value:s.data.url,onInput:i[0]||(i[0]=d=>l("update:video",d.target.value)),onBlur:i[1]||(i[1]=d=>l("blur"))},null,40,Pe)):(r(),p(P,{key:1},[y.value?(r(),p("div",Ye,[h("iframe",{src:"https://www.youtube.com/embed/"+y.value,title:"YouTube video",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,Xe)])):(r(),p("p",Be,[s.data.url?(r(),p(P,{key:0},[F(H(s.data.url),1)],64)):(r(),p(P,{key:1},[F("Double‑click to set video URL")],64))]))],64))]))}}),Le=L(Se,[["__scopeId","data-v-60696898"]]),Ue={class:"mst-canvas-card mst-canvas-date"},Ve={class:"mst-canvas-date__field"},Ne=["value"],He={class:"mst-canvas-date__field"},Oe=["value"],Re={class:"mst-canvas-date__date"},Ge={class:"mst-canvas-date__data"},Fe={class:"mst-canvas-date__countdown"},We=Y({__name:"CanvasDateElement",props:{data:{},editing:{type:Boolean}},emits:["update:date","blur"],setup(s,{emit:c}){const n=s,l=c,b=B(()=>{const i=new Date(n.data.date),d=new Date;return d.setHours(0,0,0,0),i.setHours(0,0,0,0),Math.ceil((i.getTime()-d.getTime())/(1e3*60*60*24))});function y(i){l("update:date",i,n.data.data)}function m(i){l("update:date",n.data.date,i)}return(i,d)=>(r(),p("div",Ue,[s.editing?(r(),p(P,{key:0},[h("label",Ve,[d[3]||(d[3]=h("span",{class:"mst-canvas-date__label"},"Date",-1)),h("input",{type:"date",class:"mst-canvas-date__input",value:s.data.date,onInput:d[0]||(d[0]=v=>y(v.target.value))},null,40,Ne)]),h("label",He,[d[4]||(d[4]=h("span",{class:"mst-canvas-date__label"},"Goal",-1)),h("input",{type:"text",class:"mst-canvas-date__input",value:s.data.data,placeholder:"Goal or description",onInput:d[1]||(d[1]=v=>m(v.target.value)),onBlur:d[2]||(d[2]=v=>l("blur"))},null,40,Oe)])],64)):(r(),p(P,{key:1},[h("p",Re,H(s.data.date),1),h("p",Ge,H(s.data.data),1),h("p",Fe,H(b.value>0?b.value+" days left":b.value===0?"Today":Math.abs(b.value)+" days ago"),1)],64))]))}}),Ze=L(We,[["__scopeId","data-v-25dff11d"]]),qe=Y({__name:"CanvasElementRenderer",props:{element:{},editing:{type:Boolean}},emits:["update:text","update:list","update:task","update:image","update:audio","update:video","update:date","blur"],setup(s,{emit:c}){const n=s,l=c;function b(m){switch(m.type){case"Text":return ht;case"List":return de;case"Task":return ge;case"Image":return Te;case"Audio":return ze;case"Video":return Le;case"Date":return Ze;default:return ht}}function y(m){switch(m.type){case"Text":return{text:m.data,editing:n.editing,"onUpdate:text":i=>l("update:text",i),onBlur:()=>l("blur")};case"List":return{data:m.data,editing:n.editing,"onUpdate:list":i=>l("update:list",i),onBlur:()=>l("blur")};case"Task":return{data:m.data,editing:n.editing,"onUpdate:task":(i,d)=>l("update:task",i,d),onBlur:()=>l("blur")};case"Image":return{data:m.data,editing:n.editing,"onUpdate:image":i=>l("update:image",i),onBlur:()=>l("blur")};case"Audio":return{data:m.data,editing:n.editing,"onUpdate:audio":i=>l("update:audio",i),onBlur:()=>l("blur")};case"Video":return{data:m.data,editing:n.editing,"onUpdate:video":i=>l("update:video",i),onBlur:()=>l("blur")};case"Date":return{data:m.data,editing:n.editing,"onUpdate:date":(i,d)=>l("update:date",i,d),onBlur:()=>l("blur")};default:return{text:"",editing:!1}}}return(m,i)=>(r(),Vt(Ot(b(n.element)),Nt(Ht(y(n.element))),null,16))}}),Ke=["d"],je=["d"],Qe=["data-element-id","onPointerdown","onDblclick"],Je=["onPointerdown"],ta=["onPointerdown"],ea=["onPointerdown"],aa=["onClick"],na={class:"mst-canvas-element__body"},sa={key:0,class:"mst-canvas-zoom-buttons mst-canvas-zoom-buttons--mobile"},J=2e3,tt=2e3,oa=140,ia=80,et=10,la=350,ua=Y({__name:"CanvasViewport",props:{elements:{},readOnly:{type:Boolean},backgroundImage:{},backgroundColor:{},selectedAddType:{}},emits:["move","resize","edit","edit:list","edit:task","edit:image","edit:audio","edit:video","edit:date","delete","connect","add"],setup(s,{emit:c}){const n=s,l=c,b=k(null),{transformStyle:y,zoomAt:m,panBy:i,zoomBy:d,zoom:v,offsetX:I,offsetY:E}=qt(),C=k(null),U=k(null),z=k(null),_=k(null),f=k(0),u=k(0),T=k(!1),w=k(null),A=k(null),D=k(new Map),V=k(null),$=k(null),M=k(null),X=k(null),st=k(null),ot=k(0),Z=B(()=>n.elements.find(t=>t.id===C.value)||null),it=B(()=>n.elements.find(t=>t.id===U.value)||null),ct=B(()=>w.value?n.elements.find(t=>t.id===w.value):null);function q(t,e){const a=b.value;if(!a)return{x:0,y:0};const o=a.getBoundingClientRect(),g=t-o.left,x=e-o.top;return{x:(g-I.value)/v.value,y:(x-E.value)/v.value}}function W(t){return{x:t.position.x+t.size.x/2,y:t.position.y+t.size.y/2}}function dt(t,e){for(const a of[...n.elements].reverse()){const{position:o,size:g}=a;if(t>=o.x&&t<=o.x+g.x&&e>=o.y&&e<=o.y+g.y)return a}return null}function Tt(t,e){if(t===e)return!1;const a=n.elements.find(g=>g.id===t);return a?!a.connections.some(g=>g.target===e):!1}const K=B(()=>{if(!w.value||!A.value)return null;const t=dt(A.value.x,A.value.y);return!t||!Tt(w.value,t.id)?null:t.id}),$t=B(()=>C.value!=null||U.value!=null||w.value!=null);function rt(t){if(!t.ctrlKey)return;t.preventDefault();const e=b.value;if(!e)return;const a=e.getBoundingClientRect(),o=t.clientX-a.left,g=t.clientY-a.top,x=t.deltaY>0?-.1:.1;m(o,g,x),lt()}function lt(){const t=b.value;if(!t)return;const e=t.getBoundingClientRect(),a=e.width-J*v.value,o=e.height-tt*v.value;I.value=Math.max(a,Math.min(0,I.value)),E.value=Math.max(o,Math.min(0,E.value))}function It(t){const e=q(t.clientX,t.clientY);dt(e.x,e.y)||(t.button===1||t.pointerType==="touch")&&(t.pointerType==="touch"?(D.value=new Map(D.value),D.value.set(t.pointerId,{clientX:t.clientX,clientY:t.clientY}),D.value.size===1?(V.value={x:t.clientX,y:t.clientY},$.value=n.selectedAddType?{x:e.x,y:e.y,clientX:t.clientX,clientY:t.clientY}:null):D.value.size===2&&($.value=null)):(t.preventDefault(),T.value=!0,f.value=t.clientX,u.value=t.clientY))}function Dt(t){if(t.preventDefault(),n.readOnly)return;const e=t.dataTransfer?.getData("text/plain");if(!e)return;const{x:a,y:o}=q(t.clientX,t.clientY);l("add",{type:e,x:a,y:o})}function Mt(t,e){if(!(e.button!==0&&e.pointerType==="mouse")&&!n.readOnly&&z.value!==t){if(e.pointerType==="touch"){const a=new Map(D.value);a.set(e.pointerId,{clientX:e.clientX,clientY:e.clientY}),D.value=a,M.value={x:e.clientX,y:e.clientY},X.value=t;return}C.value=t,f.value=e.clientX,u.value=e.clientY}}function Ct(t,e){if(!(e.button!==0&&e.pointerType==="mouse")&&!n.readOnly){if(e.preventDefault(),e.stopPropagation(),X.value=null,e.pointerType==="touch"){const a=new Map(D.value);a.set(e.pointerId,{clientX:e.clientX,clientY:e.clientY}),D.value=a}C.value=t,f.value=e.clientX,u.value=e.clientY}}function Et(t,e){e.button!==0&&e.pointerType==="mouse"||n.readOnly||(e.preventDefault(),X.value=null,U.value=t,f.value=e.clientX,u.value=e.clientY)}function zt(t,e){if(e.button!==0&&e.pointerType==="mouse"||n.readOnly)return;e.preventDefault(),e.stopPropagation(),X.value=null,w.value=t;const a=q(e.clientX,e.clientY);A.value={x:a.x,y:a.y}}function pt(t){const e=q(t.clientX,t.clientY);if(t.pointerType==="touch"){const a=new Map(D.value);if(a.has(t.pointerId)&&(a.set(t.pointerId,{clientX:t.clientX,clientY:t.clientY}),D.value=a),a.size===2){const o=Array.from(a.values()),g=o[0],x=o[1];if(!g||!x)return;const N=Math.hypot(x.clientX-g.clientX,x.clientY-g.clientY),O=(g.clientX+x.clientX)/2,Bt=(g.clientY+x.clientY)/2,gt=b.value;if(gt){const _t=gt.getBoundingClientRect(),St=O-_t.left,Lt=Bt-_t.top,Q=window._pinchPrevDist;if(Q!=null&&Q>0){const Ut=(N-Q)/Q*.5;m(St,Lt,Ut),lt()}window._pinchPrevDist=N}$.value=null;return}if(a.size===1&&V.value){const o=Math.abs(t.clientX-V.value.x),g=Math.abs(t.clientY-V.value.y);(o>et||g>et)&&(T.value||(T.value=!0,f.value=V.value.x,u.value=V.value.y),$.value=null)}if(X.value&&M.value){const o=Math.abs(t.clientX-M.value.x),g=Math.abs(t.clientY-M.value.y);(o>et||g>et)&&(X.value=null)}}if(T.value){const a=t.clientX-f.value,o=t.clientY-u.value;f.value=t.clientX,u.value=t.clientY,i(a,o),lt();return}if(w.value!==null){A.value={x:e.x,y:e.y};return}if(C.value&&Z.value){const a=(t.clientX-f.value)/v.value,o=(t.clientY-u.value)/v.value;f.value=t.clientX,u.value=t.clientY;const g=Z.value.position,x=Z.value.size,N=Math.min(J-x.x,Math.max(0,g.x+a)),O=Math.min(tt-x.y,Math.max(0,g.y+o));l("move",{id:Z.value.id,x:N,y:O});return}if(U.value&&it.value){const a=(t.clientX-f.value)/v.value,o=(t.clientY-u.value)/v.value;f.value=t.clientX,u.value=t.clientY;const{position:g,size:x}=it.value,N=Math.min(J-g.x,Math.max(oa,x.x+a)),O=Math.min(tt-g.y,Math.max(ia,x.y+o));l("resize",{id:it.value.id,width:Math.round(N),height:Math.round(O)})}}function j(t){if(t.pointerType==="touch"){const e=new Map(D.value);if(e.delete(t.pointerId),D.value=e,e.size<2&&(window._pinchPrevDist=void 0),e.size===0&&(V.value=null,$.value&&n.selectedAddType&&l("add",{type:n.selectedAddType,x:$.value.x,y:$.value.y}),$.value=null,X.value)){const a=X.value;X.value=null;const o=Date.now();st.value===a&&o-ot.value<la?(z.value=a,_.value=null,setTimeout(()=>{const g=b.value?.querySelector(`[data-element-id="${a}"]`);_.value=g},0),st.value=null,ot.value=0):(st.value=a,ot.value=o)}}else X.value=null;if(w.value!==null&&(t.button===0||t.pointerType==="touch")){const e=K.value;e&&l("connect",{self:w.value,target:e}),w.value=null,A.value=null}M.value=null,C.value=null,U.value=null,T.value=!1}function At(t){n.readOnly||(z.value=t,_.value=null,setTimeout(()=>{const e=b.value?.querySelector(`[data-element-id="${t}"]`);_.value=e},0))}function Pt(t,e){l("edit",{id:t,text:e})}function Yt(){z.value=null,_.value=null}function Xt(t){l("delete",t)}function vt(t,e,a,o){const g=(t+a)/2,x=(e+o)/2,N=g+(o-e)*.2,O=x-(a-t)*.2;return`M ${t} ${e} Q ${N} ${O} ${a} ${o}`}function mt(t){const e=n.elements.find(x=>x.id===t.self),a=n.elements.find(x=>x.id===t.target);if(!e||!a)return null;const o=W(e),g=W(a);return vt(o.x,o.y,g.x,g.y)}const ft=B(()=>{if(!ct.value||!A.value)return null;const t=K.value?n.elements.find(g=>g.id===K.value):null,e=t?W(t).x:A.value.x,a=t?W(t).y:A.value.y,o=W(ct.value);return vt(o.x,o.y,e,a)});function yt(t){if(z.value==null)return;const e=t.target;_.value?.contains(e)||(z.value=null,_.value=null)}return Rt(()=>{window.addEventListener("pointerup",j),window.addEventListener("pointercancel",j),window.addEventListener("pointermove",pt),document.addEventListener("pointerdown",yt,!0);const t=b.value;t&&t.addEventListener("wheel",rt,{passive:!1})}),Gt(()=>{window.removeEventListener("pointerup",j),window.removeEventListener("pointercancel",j),window.removeEventListener("pointermove",pt),document.removeEventListener("pointerdown",yt,!0);const t=b.value;t&&t.removeEventListener("wheel",rt)}),(t,e)=>(r(),p("div",{ref_key:"viewportRef",ref:b,class:nt(["mst-canvas-viewport",{"mst-canvas-viewport--moving-resizing-connecting":$t.value,"mst-canvas-viewport--readonly":s.readOnly}]),onPointerdown:It,onDragover:e[2]||(e[2]=R(()=>{},["prevent"])),onDrop:Dt},[h("div",{class:"mst-canvas-inner",style:ut({transform:at(y),backgroundColor:n.backgroundColor??void 0,backgroundImage:n.backgroundImage?`url(${n.backgroundImage})`:void 0,backgroundSize:n.backgroundImage?"100% 100%":void 0,backgroundPosition:n.backgroundImage?"0 0":void 0,backgroundRepeat:n.backgroundImage?"no-repeat":void 0})},[bt(Qt),(r(),p("svg",{class:"mst-canvas-connections",width:J,height:tt},[e[3]||(e[3]=Ft('<defs data-v-42ed1340><filter id="mst-connection-glow" x="-20%" y="-20%" width="140%" height="140%" data-v-42ed1340><feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur" data-v-42ed1340></feGaussianBlur><feMerge data-v-42ed1340><feMergeNode in="blur" data-v-42ed1340></feMergeNode><feMergeNode in="SourceGraphic" data-v-42ed1340></feMergeNode></feMerge></filter><linearGradient id="mst-connection-stroke" x1="0%" y1="0%" x2="100%" y2="0%" data-v-42ed1340><stop offset="0%" stop-color="var(--mst-color-accent)" stop-opacity="0.7" data-v-42ed1340></stop><stop offset="100%" stop-color="var(--mst-color-surface-border)" stop-opacity="1" data-v-42ed1340></stop></linearGradient></defs>',1)),(r(!0),p(P,null,G(n.elements,a=>(r(),p("g",{key:"conn-"+a.id},[(r(!0),p(P,null,G(a.connections,o=>Wt((r(),p("path",{key:o.self+"-"+o.target,d:mt(o),class:"mst-canvas-connection-path",fill:"none"},null,8,Ke)),[[Zt,mt(o)]])),128))]))),128)),ft.value?(r(),p("path",{key:0,d:ft.value,class:"mst-canvas-connection-draft",fill:"none"},null,8,je)):S("",!0)])),(r(!0),p(P,null,G(n.elements,a=>(r(),p("div",{key:a.id,"data-element-id":a.id,class:nt(["mst-canvas-element-wrapper",{"mst-canvas-element--connect-target":K.value===a.id}]),style:ut({left:a.position.x+"px",top:a.position.y+"px",width:a.size.x+"px",height:a.size.y+"px"}),onPointerdown:R(o=>Mt(a.id,o),["stop"]),onDblclick:R(o=>At(a.id),["stop"])},[s.readOnly?S("",!0):(r(),p("button",{key:0,type:"button",class:"mst-canvas-element__move",title:"Move","aria-label":"Move element",onPointerdown:R(o=>Ct(a.id,o),["stop"])}," ⋮⋮ ",40,Je)),s.readOnly?S("",!0):(r(),p("div",{key:1,class:"mst-canvas-element__connect-handle",title:"Drag to connect",onPointerdown:R(o=>zt(a.id,o),["stop"])},null,40,ta)),s.readOnly?S("",!0):(r(),p("div",{key:2,class:"mst-canvas-element__resize",onPointerdown:R(o=>Et(a.id,o),["stop","prevent"])},null,40,ea)),s.readOnly?S("",!0):(r(),p("button",{key:3,class:"mst-canvas-element__delete",type:"button",onClick:R(o=>Xt(a.id),["stop"]),title:"Delete"}," × ",8,aa)),h("div",na,[bt(qe,{element:a,editing:z.value===a.id,"onUpdate:text":o=>Pt(a.id,o),"onUpdate:list":o=>l("edit:list",{id:a.id,listData:o}),"onUpdate:task":(o,g)=>l("edit:task",{id:a.id,data:o,checked:g}),"onUpdate:image":o=>l("edit:image",{id:a.id,base64File:o}),"onUpdate:audio":o=>l("edit:audio",{id:a.id,base64File:o}),"onUpdate:video":o=>l("edit:video",{id:a.id,url:o}),"onUpdate:date":(o,g)=>l("edit:date",{id:a.id,date:o,data:g}),onBlur:Yt},null,8,["element","editing","onUpdate:text","onUpdate:list","onUpdate:task","onUpdate:image","onUpdate:audio","onUpdate:video","onUpdate:date"])])],46,Qe))),128))],4),s.readOnly?S("",!0):(r(),p("div",sa,[h("button",{type:"button",class:"mst-canvas-zoom-btn","aria-label":"Zoom in",onClick:e[0]||(e[0]=a=>at(d)(.2))},"+"),h("button",{type:"button",class:"mst-canvas-zoom-btn","aria-label":"Zoom out",onClick:e[1]||(e[1]=a=>at(d)(-.2))},"−")]))],34))}}),ka=L(ua,[["__scopeId","data-v-42ed1340"]]),ca={key:0,class:"mst-canvas-toolbar"},da=["onDragstart","onClick"],ra=["src","alt"],pa={class:"mst-canvas-toolbar__label"},va=Y({__name:"CanvasToolbar",props:{readOnly:{type:Boolean},selectedAddType:{}},emits:["update:selectedAddType"],setup(s,{emit:c}){const n=s,l=c,b=[{type:"Text",label:"Text",icon:"/assets/icons/text-icon.svg"},{type:"List",label:"List",icon:"/assets/icons/list-icon.svg"},{type:"Task",label:"Task",icon:"/assets/icons/task-icon.svg"},{type:"Image",label:"Image",icon:"/assets/icons/image-icon.svg"},{type:"Audio",label:"Audio",icon:"/assets/icons/audio-icon.svg"},{type:"Video",label:"Video",icon:"/assets/icons/video-icon.svg"},{type:"Date",label:"Date",icon:"/assets/icons/date-icon.svg"}];function y(i,d){d.dataTransfer?.setData("text/plain",i),d.dataTransfer.effectAllowed="copy";const v=document.createElement("div");v.className="mst-drag-ghost",v.textContent=i,v.style.cssText=`
    position: absolute; left: -9999px; top: 0;
    padding: 8px 14px; border-radius: 10px;
    border: 2px solid rgba(68, 211, 255, 0.8);
    background: rgba(31, 41, 55, 0.85);
    color: #e0f7ff; font-size: 12px; font-weight: 600;
    pointer-events: none; white-space: nowrap;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  `,document.body.appendChild(v),d.dataTransfer?.setDragImage(v,24,16),requestAnimationFrame(()=>v.remove())}function m(i){const d=n.selectedAddType===i.type?null:i.type;l("update:selectedAddType",d)}return(i,d)=>s.readOnly?S("",!0):(r(),p("aside",ca,[(r(),p(P,null,G(b,v=>h("button",{key:v.type,class:nt(["mst-canvas-toolbar__item",{"mst-canvas-toolbar__item--selected":n.selectedAddType===v.type}]),draggable:"true",type:"button",onDragstart:I=>y(v.type,I),onClick:I=>m(v)},[h("img",{src:v.icon,alt:v.label,class:"mst-canvas-toolbar__icon"},null,8,ra),h("span",pa,H(v.label),1)],42,da)),64))]))}}),wa=L(va,[["__scopeId","data-v-d68c8b6b"]]),ma=140,fa=80,ya=480,ga=320,_a=2e3,ba=2e3;function wt(s){return{x:Math.min(ya,Math.max(ma,s.x)),y:Math.min(ga,Math.max(fa,s.y))}}function Ta(s){const c=k([...s]);function n(_,f){c.value=c.value.map(u=>u.id===_?{...u,...f}:u)}function l(_,f){n(_,{position:f})}function b(_,f){n(_,{size:wt(f)})}function y(_,f){c.value=c.value.map(u=>u.id!==_?u:u.type==="Text"?{...u,data:f}:u)}function m(_,f){c.value=c.value.map(u=>u.id!==_||u.type!=="List"?u:{...u,data:{listData:f}})}function i(_,f,u){c.value=c.value.map(T=>T.id!==_||T.type!=="Task"?T:{...T,data:{data:f,checked:u}})}function d(_,f){c.value=c.value.map(u=>u.id!==_||u.type!=="Image"?u:{...u,data:{base64File:f}})}function v(_,f){c.value=c.value.map(u=>u.id!==_||u.type!=="Audio"?u:{...u,data:{base64File:f}})}function I(_,f){c.value=c.value.map(u=>u.id!==_||u.type!=="Video"?u:{...u,data:{url:f}})}function E(_,f,u){c.value=c.value.map(T=>T.id!==_||T.type!=="Date"?T:{...T,data:{date:f,data:u}})}function C(_){c.value=c.value.filter(f=>f.id!==_).map(f=>({...f,connections:f.connections.filter(u=>u.self!==_&&u.target!==_)}))}function U(_,f){_!==f&&(c.value=c.value.map(u=>u.id!==_||u.connections.some(w=>w.self===_&&w.target===f)?u:{...u,connections:[...u.connections,{self:_,target:f}]}))}function z(_,f,u){const w=wt({x:220,y:100}),A=Math.min(_a-w.x,Math.max(0,f-w.x/2)),D=Math.min(ba-w.y,Math.max(0,u-w.y/2)),$={id:`el_${Math.random().toString(36).slice(2,9)}`,position:{x:A,y:D,z:0},size:w,connections:[]};let M;switch(_){case"Text":M={...$,type:"Text",data:"New note"};break;case"List":M={...$,type:"List",data:{listData:["Item 1","Item 2"]}};break;case"Task":M={...$,type:"Task",data:{data:"New task",checked:!1}};break;case"Image":M={...$,type:"Image",data:{base64File:""}};break;case"Audio":M={...$,type:"Audio",data:{base64File:""}};break;case"Video":M={...$,type:"Video",data:{url:""}};break;case"Date":M={...$,type:"Date",data:{date:new Date().toISOString().slice(0,10),data:"Goal"}};break;default:M={...$,type:"Text",data:"New note"}}c.value=[...c.value,M]}return{elements:c,updateElement:n,updatePosition:l,updateSize:b,updateText:y,updateList:m,updateTask:i,updateImage:d,updateAudio:v,updateVideo:I,updateDate:E,removeElement:C,addConnection:U,addElement:z}}export{wa as C,ka as a,Ta as u};
